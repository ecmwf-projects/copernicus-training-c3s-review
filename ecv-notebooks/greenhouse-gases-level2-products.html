
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>How to access, read and process satellite CO2 and CH4 Level 2 products &#8212; C3S Training</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/bootstrap.css?digest=796348d33e8b1d947c94" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=796348d33e8b1d947c94" rel="stylesheet">

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=796348d33e8b1d947c94" rel="stylesheet">
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2">
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=4ec06e9971c5264fbd345897d5258098f11cc577" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94">
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=8bf782fb4ee92b3d3646425e50f299c4e1fd152d"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ecv-notebooks/greenhouse-gases-level2-products';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to access, read and process satellite XCO2 and XCH4 Level 3 data products" href="greenhouse-gases-level3-products.html" />
    <link rel="prev" title="Visualising Lake Surface Water Temperature (LSWT) as timeseries at one location on a given lake and the spatial distribution of the LSWT for a given day" href="lake-surface-water-temperature.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="docsearch:language" content="en">
  </head>
  
  
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="180" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>

  
  <input type="checkbox" class="sidebar-toggle" name="__primary" id="__primary">
  <label class="overlay overlay-primary" for="__primary"></label>

  
  <input type="checkbox" class="sidebar-toggle" name="__secondary" id="__secondary">
  <label class="overlay overlay-secondary" for="__secondary"></label>

  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
      
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
  </div>

  
  <nav class="bd-header navbar navbar-expand-lg bd-navbar" id="navbar-main"><div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
      <span class="fa-solid fa-bars"></span>
  </label>
  <div id="navbar-start">
    
    
  


<a class="navbar-brand logo" href="../intro.html">

  
  
  
  
  
  
  

  
    <img src="../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    
  </div>

  
  <div class="col-lg-9 navbar-header-items">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cds-tutorial.html">
                        CDS tutorial
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reanalysis-climatology.html">
                        Climatology
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reanalysis-heatwave.html">
                        Heatwave Analysis
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../projections-cmip6.html">
                        Climate Projections (CMIP6)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../projections-cordex.html">
                        Climate Projections (CORDEX)
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../sf-anomalies.html">
                        Seasonal Forecast Anomalies
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../sf-verification.html">
                        Seasonal Forecast Verification
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../ci-windchill.html">
                        Windchill Index Calculation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="erb-outgoing-longwave-radiation.html">
                        Outgoing Longwave Radiation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="soil-moisture-anomalies.html">
                        Soil Moisture Anomaly Analysis
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="lake-water-level.html">
                        Lake Water Level Timeseries
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="lake-surface-water-temperature.html">
                        Lake Surface Water Temperature Analysis
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Greenhouse Gas Level 2 Products
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="greenhouse-gases-level3-products.html">
                        Greenhouse Gas Level 3 Products
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cems-notebooks/visualising-fwi-for-esotc.html">
                        Visualising fire weather index (FWI)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cems-notebooks/glofas-bangladesh-floods.html">
                        Observing major flood events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://ibicus.readthedocs.io/en/latest/getting_started/overview.html">
                        Python library (ibicus) and tutorials on bias correction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://ecmwf-projects.github.io/copernicus-training-cams/">
                        Tutorials from the Copernicus Atmosphere Monitoring Service (CAMS)
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
    </div>

    <div id="navbar-end">
      
        <div class="navbar-end-item navbar-persistent--container">
          
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
        </div>
      
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>


  
  
    <div class="navbar-persistent--mobile">
<button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-toggle="tooltip">
  <i class="fa-solid fa-magnifying-glass"></i>
</button>
    </div>
  

  
  <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
  </label>
  

</div>
  </nav>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        
  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
      
      <div class="navbar-center-item">
        <nav class="navbar-nav">
    <p class="sidebar-header-items__title" role="heading" aria-level="1" aria-label="Site Navigation">
        Site Navigation
    </p>
    <ul id="navbar-main-elements" class="navbar-nav">
        
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cds-tutorial.html">
                        CDS tutorial
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reanalysis-climatology.html">
                        Climatology
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reanalysis-heatwave.html">
                        Heatwave Analysis
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../projections-cmip6.html">
                        Climate Projections (CMIP6)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../projections-cordex.html">
                        Climate Projections (CORDEX)
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../sf-anomalies.html">
                        Seasonal Forecast Anomalies
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../sf-verification.html">
                        Seasonal Forecast Verification
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../ci-windchill.html">
                        Windchill Index Calculation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="erb-outgoing-longwave-radiation.html">
                        Outgoing Longwave Radiation
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="soil-moisture-anomalies.html">
                        Soil Moisture Anomaly Analysis
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="lake-water-level.html">
                        Lake Water Level Timeseries
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="lake-surface-water-temperature.html">
                        Lake Surface Water Temperature Analysis
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Greenhouse Gas Level 2 Products
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="greenhouse-gases-level3-products.html">
                        Greenhouse Gas Level 3 Products
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cems-notebooks/visualising-fwi-for-esotc.html">
                        Visualising fire weather index (FWI)
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../cems-notebooks/glofas-bangladesh-floods.html">
                        Observing major flood events
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://ibicus.readthedocs.io/en/latest/getting_started/overview.html">
                        Python library (ibicus) and tutorials on bias correction
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-external" href="https://ecmwf-projects.github.io/copernicus-training-cams/">
                        Tutorials from the Copernicus Atmosphere Monitoring Service (CAMS)
                      </a>
                    </li>
                
                </div>
            </div>
            
    </ul>
</nav>
      </div>
      
      </div>
    

    
    
    <div class="sidebar-header-items__end">
      
      <div class="navbar-end-item">
        <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
</button>
      </div>
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
    
  </div>

  
  <div class="sidebar-start-items sidebar-primary__section">
    <div class="sidebar-start-items__item">
  


<a class="navbar-brand logo" href="../intro.html">

  
  
  
  
  
  
  

  
    <img src="../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="Logo image">
    <img src="../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="Logo image">
  
  
</a>
    </div>
    <div class="sidebar-start-items__item">
<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
    </div>
    <div class="sidebar-start-items__item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Copernicus Climate Change Service (C3S) Data Tutorials
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Climate Data Store (CDS)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cds-tutorial.html">CDS tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reanalysis Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reanalysis-climatology.html">Climatology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reanalysis-heatwave.html">Heatwave Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projections-cmip6.html">Climate Projections (CMIP6)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projections-cordex.html">Climate Projections (CORDEX)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sf-anomalies.html">Seasonal Forecast Anomalies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sf-verification.html">Seasonal Forecast Verification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Climate Indices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ci-windchill.html">Windchill Index Calculation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials using Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="erb-outgoing-longwave-radiation.html">Outgoing Longwave Radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="soil-moisture-anomalies.html">Soil Moisture Anomaly Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="lake-water-level.html">Tutorial: Visualising Lake Water Level (LWL) timeseries</a></li>




<li class="toctree-l1"><a class="reference internal" href="lake-surface-water-temperature.html">Lake Surface Water Temperature Analysis</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Greenhouse Gas Level 2 Products</a></li>
<li class="toctree-l1"><a class="reference internal" href="greenhouse-gases-level3-products.html">Greenhouse Gas Level 3 Products</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Turorials using Copernicus Emergency Management Service data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cems-notebooks/visualising-fwi-for-esotc.html">Visualising fire weather index (FWI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cems-notebooks/glofas-bangladesh-floods.html">Observing major flood events</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Bias Correction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://ibicus.readthedocs.io/en/latest/getting_started/overview.html">Python library (ibicus) and tutorials on bias correction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Atmosphere Monitoring Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://ecmwf-projects.github.io/copernicus-training-cams/">Tutorials from the Copernicus Atmosphere Monitoring Service (CAMS)</a></li>
</ul>

    </div>
</nav>
    </div>
  </div>
  

  
  <div class="sidebar-end-items sidebar-primary__section">
    <div class="sidebar-end-items__item">
    </div>
  </div>

  
  <div id="rtd-footer-container"></div>

      </div>
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

        <div class="bd-content">
          <div class="bd-article-container">
            
            <div class="bd-header-article">
                



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        <label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" data-toggle="tooltip" data-placement="right" title="Toggle primary sidebar">
            <span class="fa-solid fa-bars"></span>
        </label>
    </div>
    <div class="header-article__right">


<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://mybinder.org/v2/gh/ecmwf-projects/copernicus-training-c3s-review/review?urlpath=tree/ecv-notebooks/greenhouse-gases-level2-products.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</a>
      
  </ul>
</div>

<button onclick="toggleFullScreen()"
  class="btn btn-sm"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<div class="dropdown dropdown-repository-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="https://github.com/ecmwf-projects/copernicus-training-c3s-review" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">repository</span>
</a>
</a>
      
      <li><a href="https://github.com/ecmwf-projects/copernicus-training-c3s-review/issues/new?title=Issue%20on%20page%20%2Fecv-notebooks/greenhouse-gases-level2-products.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">open issue</span>
</a>
</a>
      
  </ul>
</div>



<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      <li><a href="../_sources/ecv-notebooks/greenhouse-gases-level2-products.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</a>
      
      <li>
<button onclick="printPdf(this)"
  class="btn btn-sm dropdown-item"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</a>
      
  </ul>
</div>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary" data-toggle="tooltip" data-placement="left" title="Toggle secondary sidebar">
            <span class="fa-solid fa-list"></span>
        </label>
    </div>
</div>
            </div>
            
            

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to access, read and process satellite CO2 and CH4 Level 2 products</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-get-the-satellite-data-products">
   How to get the satellite data products:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-download-from-the-cds-via-the-cdsapi">
     Data download from the CDS via the cdsapi:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-access-read-and-process-the-satellite-data-with-python">
   How to access, read and process the satellite data with Python:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-user-input">
   Initial user input:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-additional-product-parameters-etc">
   Get additional product parameters etc.:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-data-from-cds-if-needed">
   Download data from CDS if needed:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-daily-data-from-l2-file">
   Get daily data from L2 file:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-daily-data-as-a-function-of-latitude">
   Plot daily data as a function of latitude:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-data-on-a-map">
   Plot data on a map:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-a-priori-profile-and-averaging-kernel">
   Plot a priori profile and averaging kernel:
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>

            <article class="bd-article" role="main">
              
  <p><img alt="logo" src="../_images/LogoLine_horizon_C3S.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-access-read-and-process-satellite-co2-and-ch4-level-2-products">
<h1>How to access, read and process satellite CO2 and CH4 Level 2 products<a class="headerlink" href="#how-to-access-read-and-process-satellite-co2-and-ch4-level-2-products" title="Permalink to this heading">#</a></h1>
<p>This is a Jupyter Notebook illustrating how to access, read and process Greenhouse Gas (GHG) carbon dioxide (CO2) and methane (CH4) data products as generated in the framework of the Copernicus Climate Change Service (C3S) project C3S2_312a_Lot2.</p>
<p>The data products are retrieved from satellite radiance measurements using appropriate retrieval algorithms.
Most of these algorithms have been developed in the past within the Climate Change Initiative (CCI) of the European Space Agency (ESA). These algorithms are now used to operationally generate the corresponding data products within the European Union (EU) C3S project. The data products are freely available for all interested users from the Copernicus Climate Data Store (CDS, <a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a>).</p>
<p>In project C3S2_312a_Lot2 several satellite-derived Essential Climate Variable (ECV) atmospheric data products are generated for GHGs (CO2 and CH4), aerosols and ozone. This Jupyter Notebook (JN) focusses on GHG Level 2 (L2) products. The other products are covered by separate JNs. L2 products contain retrieved parameters for individual satellite ground pixels (footprints). In contrast to Level 3 products, the L2 products are not averaged in space and time, but provided information at sensor resolution, sampling and time.</p>
<p>Here it will be shown how the data products can be obtained from the CDS and how they can be processed to extract important information and how to visualize this information.</p>
<p>Within this JN, we use two types of satellite-based GHG L2 products: (i) Column-averaged dry-air mole fractions of CO2 and CH4, denoted XCO2 and XCH4 and (ii) mid-tropospheric columns of CO2 and CH4. The unit of the XCO2 and CO2 products is parts per million (ppm) and the unit of the XCH4 and CH4 products is parts per billion (ppb). The XCO2 and XCH4 products are derived from SCIAMACHY/ENVISAT, GOSAT, GOSAT-2 and OCO-2. The mid-tropospheric CO2 and CH4 products are derived from IASI on Metop-A and Metop-B and for CO2 also from AIRS.</p>
<p>This JN has been tested using the latest versions of the satellite data products collectively referred to as “Climate Data Record 6” (CDR6). CDR6 covers the time period 2003-2021 but temporal coverage of a given product depends on the availability of the underlying satellite data. The L2 products are daily files in NetCDF format. As the data product format has not changed in recent years it is possible to read and process also earlier versions of the data products. The products are global but daily spatial coverage is sparse due to the sampling of the satellite data and strict quality filtering (e.g., to minimize the impact of clouds).</p>
<p>This document is provided “as is” and no guarantee of warranty is given that the content is fit for any particular purpose.
The users thereof use this document at their sole risk and liability.</p>
<section id="how-to-get-the-satellite-data-products">
<h2>How to get the satellite data products:<a class="headerlink" href="#how-to-get-the-satellite-data-products" title="Permalink to this heading">#</a></h2>
<p>Each satellite-derived CO2 or CH4 data product as generated in C3S project C3S2_312a_Lot2 has a unique product identifier (ID). The product IDs of all Level 2 products are listed below (see variable “product_id” in function “get_product_paras”).</p>
<p>All L2 products are provided as daily NetCDF files.</p>
<p>On the CDS website all products can be selected manually by clicking on the relevant entries:</p>
<p>For CO2 see:
<a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-carbon-dioxide?tab=form">https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-carbon-dioxide?tab=form</a>.</p>
<p>For CH4 see:
<a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-methane?tab=form">https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-methane?tab=form</a>.</p>
<p>User can select a product and download it.</p>
<p>However, depending on application, it may be more convenient for user to access the products via the CDS API (cdsapi). Below in Section “Data download from the CDS via the cdsapi” we describe how to do this.</p>
<p>Independently of how the L2 data products have been obtained, we assume here that the downloaded L2 files are stored in subdirectories, which correspond to the following structure:</p>
<p>.\L2_files{product_id}\</p>
<p>Here {product_id} is the product ID (see “product_id” in “get_product_paras”). Example: We assume that the XCO2_EMMA product files are stored in sub-directory .\L2_files\XCO2_EMMA.</p>
<section id="data-download-from-the-cds-via-the-cdsapi">
<h3>Data download from the CDS via the cdsapi:<a class="headerlink" href="#data-download-from-the-cds-via-the-cdsapi" title="Permalink to this heading">#</a></h3>
<p>How to use the CDS API is describe here: <a class="reference external" href="https://cds.climate.copernicus.eu/api-how-to">https://cds.climate.copernicus.eu/api-how-to</a>. This includes how to install the CDS API key on your system and how to add the relevant URL.</p>
<p>The CDS API (cdsapi) needs to be installed on your system, e.g., via the following command: pip install cdsapi.</p>
<p>Statement “import cdsapi” needs to be added to make the functionallity of the CDS API available (see section “Imports”).</p>
<p>How to activate data download via cdsapi please see section “Initial user input”. In short:</p>
<ul class="simple">
<li><p>Download is activated via: do_download_L2_data_via_cdsapi = 1.</p></li>
<li><p>Product selection is done by setting variables product_id and and product_ver. Example: product_id = ‘XCO2_EMMA’; product_ver = ‘4.4’</p></li>
<li><p>After data download the following file will be stored in your local directory: download.zip.</p></li>
<li><p>Unzip the file and move the downloaded daily NetCDF file to a subdirectory, which correspond to the following structure: .\L2_files{product_id}, where {product_id} is the product ID (see “product_id” in function “get_product_paras”). Example: We assume here that the XCO2_EMMA product files are stored in sub-directory .\L2_files\XCO2_EMMA.</p></li>
</ul>
<p>The downloaded product files will then be used by deactivating the download: do_download_L2_data_via_cdsapi = 0. This disables data download and enables reading and processing the data.</p>
</section>
</section>
<section id="how-to-access-read-and-process-the-satellite-data-with-python">
<h2>How to access, read and process the satellite data with Python:<a class="headerlink" href="#how-to-access-read-and-process-the-satellite-data-with-python" title="Permalink to this heading">#</a></h2>
<p>In the following, Phython 3 code is provided to read and process the satellite data.</p>
<p>It is assumed that Python and Jupyter Notebook (JN) is installed on your computer, e.g., using the Anaconda distribution
(<a class="reference external" href="https://www.anaconda.com/products/distribution">https://www.anaconda.com/products/distribution</a>).</p>
<p>The code starts with importing several modules as needed to run this JN. See section “Imports”.</p>
</section>
<section id="imports">
<h2>Imports:<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span> <span class="k">as</span> <span class="n">patches_Polygon</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">cdsapi</span> <span class="c1"># pip install cdsapi</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="functions">
<h2>Functions:<a class="headerlink" href="#functions" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">####################################################</span>
<span class="c1"># Read daily product file to obtain most relevant parameters:</span>
<span class="c1"># Input: </span>
<span class="c1"># main_product: &#39;XCO2&#39; or &#39;XCH4&#39;, </span>
<span class="c1"># prod_format: &#39;cci_iasi&#39; for IASI data or any other string </span>
<span class="c1"># for data for other satellites, e.g., &#39;cci&#39;</span>
<span class="c1"># in_file: satellite Level 2 file name (including path if needed),</span>
<span class="c1"># year, month, day: day of interest</span>
<span class="c1"># product_id: Product ID</span>
<span class="c1"># Output: </span>
<span class="c1"># Satellite data for each ground pixel of day of interest:</span>
<span class="c1"># sat_data:</span>
<span class="c1">#    xgas: retrieved XCO2 value (in ppm) or XCH4 value (in ppb)</span>
<span class="c1">#    xgas_err: 1-sigma uncertainty of XCO2 (in ppm) or XCH4 (in ppb)</span>
<span class="c1">#    latc: center latitude of ground pixel (-90 to +90)</span>
<span class="c1">#    lonc: center longitude of ground pixel (-180 to +180)</span>
<span class="c1">#    time: time in seconds since 1970-01-01 00:00:00</span>
<span class="c1">#    emma_pro_id: value of median_processor_id from EMMA file</span>
<span class="c1"># pre_lev: Vertical profile of pressure levels (in hPa)</span>
<span class="c1"># pre_wei: Vertical profile of pressure weights (dimensionless)</span>
<span class="c1"># gas_apri: A priori vertical profile of CO2 (in ppm) or CH4 (in ppb)</span>
<span class="c1"># gas_ak: Averaging kernel profile for XCO2 or XCH4 (dimensionless)</span>
<span class="c1"># Note: Listed numerical values are for illustration only</span>
<span class="k">def</span> <span class="nf">read_L2_file</span><span class="p">(</span><span class="n">main_product</span><span class="p">,</span> <span class="n">prod_format</span><span class="p">,</span> <span class="n">in_file</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">product_id</span><span class="p">):</span>
   <span class="n">mod_name</span> <span class="o">=</span> <span class="s1">&#39;read_L2_file&#39;</span>
   <span class="n">w_gas</span> <span class="o">=</span> <span class="n">main_product</span>
   <span class="n">sat_data</span>  <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># Init output</span>
   <span class="n">pre_lev</span>   <span class="o">=</span> <span class="kc">None</span>
   <span class="n">pre_wei</span>   <span class="o">=</span> <span class="kc">None</span>
   <span class="n">gas_apri</span>  <span class="o">=</span> <span class="kc">None</span>
   <span class="n">gas_ak</span>    <span class="o">=</span> <span class="kc">None</span>
   <span class="n">emma_pro_str</span> <span class="o">=</span> <span class="kc">None</span>
   <span class="k">if</span> <span class="p">((</span><span class="n">w_gas</span> <span class="o">!=</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">w_gas</span> <span class="o">!=</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* &#39;</span><span class="o">+</span><span class="n">mod_name</span><span class="o">+</span><span class="s1">&#39;: ERROR: w_gas not implemented: &#39;</span><span class="p">,</span> <span class="n">w_gas</span><span class="p">)</span>
      <span class="k">return</span><span class="p">(</span><span class="n">sat_data</span><span class="p">,</span> <span class="n">pre_lev</span><span class="p">,</span> <span class="n">pre_wei</span><span class="p">,</span> <span class="n">gas_apri</span><span class="p">,</span> <span class="n">gas_ak</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* &#39;</span><span class="o">+</span><span class="n">mod_name</span><span class="o">+</span><span class="s1">&#39;: Trying to read: &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>   
   <span class="k">if</span> <span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* &#39;</span><span class="o">+</span><span class="n">mod_name</span><span class="o">+</span><span class="s1">&#39;: reading: &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
      <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>
      <span class="n">aa_latc</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">][:]</span>
      <span class="n">nn_read</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">aa_latc</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* &#39;</span><span class="o">+</span><span class="n">mod_name</span><span class="o">+</span><span class="s1">&#39;: nn_read: &#39;</span><span class="p">,</span> <span class="n">nn_read</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">prod_format</span> <span class="o">==</span> <span class="s1">&#39;cci_iasi&#39;</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">w_gas</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
            <span class="n">aa_qf</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;co2_quality_flag&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;co2&#39;</span><span class="p">][:]</span> <span class="c1"># ppm</span>
            <span class="n">aa_gas_err</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;co2_uncertainty&#39;</span><span class="p">][:]</span> <span class="c1"># ppm</span>
            <span class="c1">#aa_gas_apri = ds.variables[&#39;co2_profile_apriori&#39;][:]</span>
            <span class="n">aa_gas_ak</span>   <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;co2_averaging_kernel&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas_apri</span> <span class="o">=</span> <span class="n">aa_gas_ak</span><span class="o">*</span><span class="mf">0.0</span>
         <span class="k">if</span> <span class="n">w_gas</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
            <span class="n">aa_qf</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ch4_quality_flag&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ch4&#39;</span><span class="p">][:]</span> <span class="c1"># ppb</span>
            <span class="n">aa_gas_err</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ch4_uncertainty&#39;</span><span class="p">][:]</span> <span class="c1"># ppb</span>
            <span class="c1">#aa_gas_apri = ds.variables[&#39;ch4_profile_apriori&#39;][:]</span>
            <span class="n">aa_gas_ak</span>   <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ch4_averaging_kernel&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas_apri</span> <span class="o">=</span> <span class="n">aa_gas_ak</span><span class="o">*</span><span class="mf">0.0</span>
      <span class="k">else</span><span class="p">:</span> <span class="c1"># prod_format == &#39;cci&#39;</span>
         <span class="k">if</span> <span class="n">w_gas</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
            <span class="n">aa_qf</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2_quality_flag&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2&#39;</span><span class="p">][:]</span> <span class="c1"># ppm</span>
            <span class="n">aa_gas_err</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2_uncertainty&#39;</span><span class="p">][:]</span> <span class="c1"># ppm</span>
            <span class="n">aa_gas_apri</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;co2_profile_apriori&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas_ak</span>   <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2_averaging_kernel&#39;</span><span class="p">][:]</span>
         <span class="k">if</span> <span class="n">w_gas</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
            <span class="n">aa_qf</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4_quality_flag&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4&#39;</span><span class="p">][:]</span> <span class="c1"># ppb</span>
            <span class="n">aa_gas_err</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4_uncertainty&#39;</span><span class="p">][:]</span> <span class="c1"># ppb</span>
            <span class="n">aa_gas_apri</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ch4_profile_apriori&#39;</span><span class="p">][:]</span>
            <span class="n">aa_gas_ak</span>   <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4_averaging_kernel&#39;</span><span class="p">][:]</span>
      <span class="n">emma_pro_id_OK</span> <span class="o">=</span> <span class="mi">0</span>      
      <span class="n">emma_pro_str</span> <span class="o">=</span> <span class="s1">&#39;not_defined&#39;</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCO2_EMMA&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCH4_EMMA&#39;</span><span class="p">)):</span>
         <span class="n">aa_emma_pro_id</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;median_processor_id&#39;</span><span class="p">][:]</span>
         <span class="n">emma_pro_str</span>   <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;median_processor_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">comment</span><span class="p">[:]</span>
         <span class="n">emma_pro_id_OK</span> <span class="o">=</span> <span class="mi">1</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* --------------------------------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Algorithm related information as given in EMMA file:&#39;</span><span class="p">)</span>
            <span class="c1">#print(ds.variables[&#39;median_processor_id&#39;].comment[:])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">emma_pro_str</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* --------------------------------------------&#39;</span><span class="p">)</span>
      <span class="n">aa_pre_lev</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pressure_levels&#39;</span><span class="p">][:]</span>
      <span class="n">aa_pre_wei</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pressure_weight&#39;</span><span class="p">][:]</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># profiles from 0=surface to n_lev=top-of-atmosphere</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* aa_pre_lev.shape: &#39;</span><span class="p">,</span>  <span class="n">aa_pre_lev</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (640, 11) (n_lev, n_obs) </span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* aa_pre_wei.shape: &#39;</span><span class="p">,</span>  <span class="n">aa_pre_wei</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># (640, 10) default=one less</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* aa_gas_apri.shape: &#39;</span><span class="p">,</span> <span class="n">aa_gas_apri</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="c1"># (640, 10)</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* aa_gas_ak.shape: &#39;</span><span class="p">,</span>   <span class="n">aa_gas_ak</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>   <span class="c1"># (640, 10)</span>
      <span class="p">(</span><span class="n">idg</span><span class="p">)</span>   <span class="o">=</span> <span class="p">((</span><span class="n">aa_qf</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">))</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span> <span class="c1"># return only good quality data</span>
      <span class="n">a_qf</span>    <span class="o">=</span> <span class="n">aa_qf</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
      <span class="n">nn_good</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a_qf</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* &#39;</span><span class="o">+</span><span class="n">mod_name</span><span class="o">+</span><span class="s1">&#39;: nn_good: &#39;</span><span class="p">,</span> <span class="n">nn_good</span><span class="p">)</span>
      <span class="n">aa_time</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span> <span class="c1"># seconds since 1970-01-01 00:00:00</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nn_good</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
         <span class="n">aa_lonc</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">][:]</span> <span class="c1"># -180 to +180</span>
         <span class="c1"># --------------</span>
         <span class="n">latc</span>      <span class="o">=</span> <span class="n">aa_latc</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
         <span class="n">lonc</span>      <span class="o">=</span> <span class="n">aa_lonc</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
         <span class="n">xgas</span>      <span class="o">=</span> <span class="n">aa_gas</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
         <span class="n">xgas_err</span>  <span class="o">=</span> <span class="n">aa_gas_err</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
         <span class="n">time</span>      <span class="o">=</span> <span class="n">aa_time</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
         <span class="n">pre_lev</span>   <span class="o">=</span> <span class="n">aa_pre_lev</span><span class="p">[(</span><span class="n">idg</span><span class="p">),:]</span>
         <span class="n">pre_wei</span>   <span class="o">=</span> <span class="n">aa_pre_wei</span><span class="p">[(</span><span class="n">idg</span><span class="p">),:]</span>
         <span class="n">gas_apri</span>  <span class="o">=</span> <span class="n">aa_gas_apri</span><span class="p">[(</span><span class="n">idg</span><span class="p">),:]</span>
         <span class="n">gas_ak</span>    <span class="o">=</span> <span class="n">aa_gas_ak</span><span class="p">[(</span><span class="n">idg</span><span class="p">),:]</span>
         <span class="n">pre_lev</span>   <span class="o">=</span> <span class="n">pre_lev</span><span class="p">[</span><span class="mi">0</span><span class="p">][:][:]</span>
         <span class="n">pre_wei</span>   <span class="o">=</span> <span class="n">pre_wei</span><span class="p">[</span><span class="mi">0</span><span class="p">][:][:]</span>
         <span class="n">gas_apri</span>  <span class="o">=</span> <span class="n">gas_apri</span><span class="p">[</span><span class="mi">0</span><span class="p">][:][:]</span>
         <span class="n">gas_ak</span>    <span class="o">=</span> <span class="n">gas_ak</span><span class="p">[</span><span class="mi">0</span><span class="p">][:][:]</span>
         <span class="k">if</span> <span class="n">emma_pro_id_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">emma_pro_id</span> <span class="o">=</span> <span class="n">aa_emma_pro_id</span><span class="p">[(</span><span class="n">idg</span><span class="p">)]</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">emma_pro_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nn_good</span><span class="p">,),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># all entries are: -1</span>
         <span class="n">sat_data</span>  <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;gas&#39;</span><span class="p">:</span> <span class="n">xgas</span><span class="p">,</span> <span class="s1">&#39;gas_err&#39;</span><span class="p">:</span> <span class="n">xgas_err</span><span class="p">,</span> <span class="s1">&#39;latc&#39;</span><span class="p">:</span> <span class="n">latc</span><span class="p">,</span> <span class="s1">&#39;lonc&#39;</span><span class="p">:</span> <span class="n">lonc</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span> <span class="s1">&#39;emma_pro_id&#39;</span><span class="p">:</span> <span class="n">emma_pro_id</span><span class="p">})</span>       
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&#39;</span><span class="p">)</span>
   <span class="k">return</span><span class="p">(</span><span class="n">sat_data</span><span class="p">,</span> <span class="n">pre_lev</span><span class="p">,</span> <span class="n">pre_wei</span><span class="p">,</span> <span class="n">gas_apri</span><span class="p">,</span> <span class="n">gas_ak</span><span class="p">,</span> <span class="n">emma_pro_str</span><span class="p">)</span>  <span class="c1"># May be None</span>
<span class="c1">####################################################</span>
<span class="c1"># ... read_L2_file</span>
<span class="c1">####################################################</span>

<span class="c1"># ######################################################################## </span>
<span class="c1"># Get additional parameters for desired satellite data product</span>
<span class="c1"># including those needed to download data from the CDS</span>
<span class="c1"># ######################################################################## </span>
<span class="k">def</span> <span class="nf">get_product_paras</span><span class="p">(</span><span class="n">product_id</span><span class="p">):</span>

   <span class="c1"># Init output paras:</span>
   <span class="n">main_product</span>             <span class="o">=</span> <span class="kc">None</span>
   <span class="n">xghg_str1</span>                <span class="o">=</span> <span class="kc">None</span>
   <span class="n">xghg_str2</span>                <span class="o">=</span> <span class="kc">None</span>
   <span class="n">prod_format</span>              <span class="o">=</span> <span class="kc">None</span>
   <span class="n">prod_file_id</span>             <span class="o">=</span> <span class="kc">None</span>
   <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="kc">None</span>
   <span class="n">product_variable</span>         <span class="o">=</span> <span class="kc">None</span>
   <span class="n">prod_year_start</span>          <span class="o">=</span> <span class="kc">None</span>
   <span class="n">prod_year_end</span>            <span class="o">=</span> <span class="kc">None</span>

   <span class="c1"># Set additional parameters per product: </span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCO2_EMMA&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;merged_emma&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_SCI_BESD&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-SCIAMACHY-ENVISAT-BESD-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;sciamachy_besd&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2012</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_SCI_WFMD&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-SCIAMACHY-ENVISAT-WFMD-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;sciamachy_wfmd&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2012</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_GOS_OCFP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO-GOSAT-OCFP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso_fts_ocfp&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2009</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2020</span> <span class="c1"># until mid 2020</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_GOS_SRFP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO-GOSAT-SRFP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso_fts_srfp&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2009</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_GO2_SRFP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO2-GOSAT2-SRFP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso2_fts2_srfp&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xco2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2019</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_AIR_NLIS&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;CO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Mid-tropospheric CO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci_iasi&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-AIRS-AQUA-NLIS-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;airs_nlis&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;co2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2007</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_IASA_NLIS&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;CO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Mid-tropospheric CO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci_iasi&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-IASI-METOPA-NLIS-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;iasi_metop_a_nlis&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;co2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2007</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span> <span class="c1"># until 8.2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_IASB_NLIS&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCO2&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;CO$_2$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Mid-tropospheric CO$_2$ [ppm]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci_iasi&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-IASI-METOPB-NLIS-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;iasi_metop_b_nlis&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;co2&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2020</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------   </span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCH4_EMMA&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;merged_emma&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_SCI_WFMD&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-SCIAMACHY-ENVISAT-WFMD-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;sciamachy_wfmd&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2012</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_SCI_IMAP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-SCIAMACHY-ENVISAT-IMAP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;sciamachy_imap&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2003</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2012</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_GOS_OCFP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO-GOSAT-OCFP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso_fts_ocfp&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2009</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------   </span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_GOS_OCPR&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO-GOSAT-OCPR-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso_fts_ocpr&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2009</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_GOS_SRFP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO-GOSAT-SRFP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso_fts_srfp&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2009</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------  </span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_GOS_SRPR&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO-GOSAT-SRPR-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso_fts_srpr&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2009</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_GO2_SRFP&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO2-GOSAT2-SRFP-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso2_fts2_srfp&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2019</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_GO2_SRPR&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-TANSO2-GOSAT2-SRPR-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;tanso2_fts2_srpr&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;xch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2019</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_IASA_NLIS&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;CH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Mid-tropospheric CH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci_iasi&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-IASI-METOPA-NLIS-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;iasi_metop_a_nlis&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;ch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2007</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   <span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CH4_IASB_NLIS&#39;</span><span class="p">:</span>
      <span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>
      <span class="n">xghg_str1</span>    <span class="o">=</span> <span class="s1">&#39;CH$_4$&#39;</span>
      <span class="n">xghg_str2</span>    <span class="o">=</span> <span class="s1">&#39;Mid-tropospheric CH$_4$ [ppb]&#39;</span>
      <span class="n">prod_format</span>  <span class="o">=</span> <span class="s1">&#39;cci_iasi&#39;</span>
      <span class="n">prod_file_id</span> <span class="o">=</span> <span class="s1">&#39;-C3S-L2_GHG-GHG_PRODUCTS-IASI-METOPB-NLIS-DAILY-&#39;</span>
      <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="s1">&#39;iasi_metop_b_nlis&#39;</span>
      <span class="n">product_variable</span> <span class="o">=</span> <span class="s1">&#39;ch4&#39;</span>
      <span class="n">prod_year_start</span>  <span class="o">=</span> <span class="mi">2020</span><span class="p">;</span> <span class="n">prod_year_end</span> <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1"># --------------------------------------------------</span>
   
   <span class="n">product_paras</span> <span class="o">=</span> <span class="p">(</span><span class="n">main_product</span><span class="p">,</span> <span class="n">xghg_str1</span><span class="p">,</span> <span class="n">xghg_str2</span><span class="p">,</span> <span class="n">prod_format</span><span class="p">,</span> <span class="n">prod_file_id</span><span class="p">,</span> <span class="n">sensor_and_algorithm_str</span><span class="p">,</span> 
           <span class="n">product_variable</span><span class="p">,</span> <span class="n">prod_year_start</span><span class="p">,</span> <span class="n">prod_year_end</span><span class="p">)</span>
   
   <span class="k">return</span> <span class="n">product_paras</span>
<span class="c1">####################################################</span>
<span class="c1"># ... get_product_paras</span>
<span class="c1">####################################################</span>

<span class="c1"># ########################################################################</span>
<span class="c1"># Set colors for each data point</span>
<span class="c1"># Inputs: colors: color palette (as obtained via: colors = scmap.colors)</span>
<span class="c1">#         rmin and rmax: defines color bar range</span>
<span class="c1">#         data: data to be plotted</span>
<span class="c1"># Output: cc_col: Array of RGBs (= red, green, blue values)</span>
<span class="k">def</span> <span class="nf">mb_set_colors</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
   <span class="n">cc_col</span> <span class="o">=</span> <span class="kc">None</span>
   <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">rmax</span> <span class="o">&gt;</span> <span class="n">rmin</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">n_data</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c1"># ----------------------------------------</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
               <span class="n">col</span>     <span class="o">=</span> <span class="n">colors</span>        
               <span class="n">ncolors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
               <span class="n">cc_min</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">cc_max</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">ncolors</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
               <span class="n">d_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmax</span><span class="o">-</span><span class="n">rmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ncolors</span><span class="p">)</span>
               <span class="n">dx_val</span> <span class="o">=</span> <span class="p">((</span><span class="n">rmax</span><span class="o">-</span><span class="n">d_val</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">rmin</span><span class="o">+</span><span class="n">d_val</span><span class="p">))</span>
               <span class="n">cc_col</span> <span class="o">=</span> <span class="p">[]</span>
               <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span>
                  <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                     <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                     <span class="n">ff</span> <span class="o">=</span> <span class="p">(</span> <span class="n">val</span><span class="o">-</span><span class="p">(</span><span class="n">rmin</span><span class="p">)</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">rmax</span><span class="o">-</span><span class="n">rmin</span><span class="p">)</span>
                     <span class="n">ic</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ff</span> <span class="o">*</span> <span class="p">(</span><span class="n">ncolors</span><span class="p">)))</span>
                     <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">rmin</span><span class="o">+</span><span class="n">d_val</span><span class="p">:</span>
                        <span class="n">cc</span> <span class="o">=</span> <span class="n">cc_min</span>
                     <span class="k">elif</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">rmax</span><span class="o">-</span><span class="n">d_val</span><span class="p">:</span>
                        <span class="n">cc</span> <span class="o">=</span> <span class="n">cc_max</span>
                     <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ic</span> <span class="o">&gt;</span> <span class="n">ncolors</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                           <span class="n">ic</span> <span class="o">=</span> <span class="n">ncolors</span><span class="o">-</span><span class="mi">1</span>
                        <span class="n">cc</span> <span class="o">=</span> <span class="n">col</span><span class="p">[</span><span class="n">ic</span><span class="p">]</span>
                     <span class="n">cc_col</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cc</span><span class="p">)</span>
               <span class="n">cc_col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cc_col</span><span class="p">)</span>
         <span class="c1"># ----------------------------------------</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* mb_set_colors: ERROR: n_data must be &gt; 0&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* mb_set_colors: ERROR: rmax must be &gt; rmin&#39;</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">cc_col</span>  <span class="c1"># may be None</span>
<span class="c1"># ########################################################################</span>
<span class="c1"># ... mb_set_colors</span>
<span class="c1"># ########################################################################</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-user-input">
<h2>Initial user input:<a class="headerlink" href="#initial-user-input" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data download from CDS?:</span>
<span class="c1"># 1: yes, do it</span>
<span class="c1"># 0: no, data exist as already downloaded</span>
<span class="n">do_download_L2_data_via_cdsapi</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># Procedure for downloading data:</span>
<span class="c1"># - Select: do_download_L2_data_via_cdsapi = 1</span>
<span class="c1"># - Select one satellite product (see directly below)</span>
<span class="c1"># - Execute the code including section &quot;Download data from CDS if needed&quot;</span>
<span class="c1"># - Copy the downloaded NetCDF file into the corresponding sub-directory (see above)</span>
<span class="c1"># After data download:</span>
<span class="c1"># - Select: do_download_L2_data_via_cdsapi = 0 and run the notebook</span>

<span class="c1"># Select one satellite product (by removing first #):</span>
<span class="c1"># Product ID and version number and as comment in brackets at end of each line: </span>
<span class="c1"># &quot;Sensor and algorithm&quot; (as used on listed websites):</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="c1">### ------- Level 2 CO2 products:</span>
   <span class="c1">##  Column-average dry-air mole fraction of atmospheric Carbon Dioxide (XCO2):</span>
   <span class="n">product_id</span> <span class="o">=</span> <span class="s1">&#39;XCO2_EMMA&#39;</span><span class="p">;</span>     <span class="n">product_ver</span> <span class="o">=</span> <span class="s1">&#39;4.4&#39;</span>      <span class="c1"># (MERGED and EMMA)</span>
   <span class="c1">#product_id = &#39;CO2_SCI_BESD&#39;;  product_ver = &#39;02.01.02&#39; # (SCIAMACHY and BESD)</span>
   <span class="c1">#product_id = &#39;CO2_SCI_WFMD&#39;;  product_ver = &#39;4.0&#39;      # (SCIAMACHY and WFMD)</span>
   <span class="c1">#product_id = &#39;CO2_GOS_OCFP&#39;;  product_ver = &#39;7.3&#39;      # (TANSO-FTS and OCFP)</span>
   <span class="c1">#product_id = &#39;CO2_GOS_SRFP&#39;;  product_ver = &#39;2.3.8&#39;    # (TANSO-FTS and SRFP)</span>
   <span class="c1">#product_id = &#39;CO2_GO2_SRFP&#39;;  product_ver = &#39;2.0.0&#39;    # (TANSO2-FTS2 and SRFP)</span>
   <span class="c1">##  Mid-tropospheric columns of atmospheric Carbon Dioxide (CO2) and related variables:</span>
   <span class="c1">#product_id = &#39;CO2_AIR_NLIS&#39;;  product_ver = &#39;3.0&#39;      # (AIRS and NLIS)</span>
   <span class="c1">#product_id = &#39;CO2_IASA_NLIS&#39;; product_ver = &#39;9.1&#39;      # (IASI(Metop-A) and NLIS)</span>
   <span class="c1">#product_id = &#39;CO2_IASB_NLIS&#39;; product_ver = &#39;9.1&#39;      # (IASI(Metop-B) and NLIS)</span>
   <span class="c1">### ------- Level 2 CH4 products:</span>
   <span class="c1">##  Column-averaged dry-air mixing ratios of methane (XCH4):</span>
   <span class="c1">#product_id = &#39;XCH4_EMMA&#39;;     product_ver = &#39;4.4&#39;      # (MERGED and EMMA)</span>
   <span class="c1">#product_id = &#39;CH4_SCI_WFMD&#39;;  product_ver = &#39;4.0&#39;      # (SCIAMACHY and WFMD)</span>
   <span class="c1">#product_id = &#39;CH4_SCI_IMAP&#39;;  product_ver = &#39;7.2&#39;      # (SCIAMACHY and IMAP)</span>
   <span class="c1">#product_id = &#39;CH4_GOS_OCFP&#39;;  product_ver = &#39;7.3&#39;      # (TANSO-FTS and OCFP)</span>
   <span class="c1">#product_id = &#39;CH4_GOS_OCPR&#39;;  product_ver = &#39;9.0&#39;      # (TANSO-FTS and OCPR)</span>
   <span class="c1">#product_id = &#39;CH4_GOS_SRFP&#39;;  product_ver = &#39;2.3.8&#39;    # (TANSO-FTS and SRFP)</span>
   <span class="c1">#product_id = &#39;CH4_GOS_SRPR&#39;;  product_ver = &#39;2.3.9&#39;    # (TANSO-FTS and SRPR)</span>
   <span class="c1">#product_id = &#39;CH4_GO2_SRFP&#39;;  product_ver = &#39;2.0.0&#39;    # (TANSO2-FTS2 and SRFP)</span>
   <span class="c1">#product_id = &#39;CH4_GO2_SRPR&#39;;  product_ver = &#39;2.0.0&#39;    # (TANSO2-FTS2 and SRPR)</span>
   <span class="c1">##  Mid-tropospheric column-averaged mixing ratios of methane (CH4):</span>
   <span class="c1">#product_id = &#39;CH4_IASA_NLIS&#39;; product_ver = &#39;9.1&#39;      # (IASI(Metop-A) and NLIS)</span>
   <span class="c1">#product_id = &#39;CH4_IASB_NLIS&#39;; product_ver = &#39;9.1&#39;      # (IASI(Metop-B) and NLIS)</span>

<span class="c1"># Choose day of interest:</span>
<span class="c1"># Note: Spatial and temporal coverage depends on product and no data may be</span>
<span class="c1">#       available for selected day of interest and spatial region</span>
<span class="c1">#       (see information provided on listed websites)</span>
<span class="c1">#year = 2004; month = 9; day = 15 # eg, SCIAMACHY (until 4.2012) &amp; AIRS products (until 7.2007)</span>
<span class="c1">#year = 2019; month = 9; day = 15 # eq, SRFP and SRPR products (until mid 2020)</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2020</span><span class="p">;</span> <span class="n">month</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span> <span class="n">day</span> <span class="o">=</span> <span class="mi">15</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Selected product: &#39;</span><span class="p">,</span> <span class="n">product_id</span><span class="p">,</span> <span class="n">product_ver</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Selected day: YYYY MM DD:&#39;</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Selected product:  XCO2_EMMA 4.4
* Selected day: YYYY MM DD: 2020 9 15
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-additional-product-parameters-etc">
<h2>Get additional product parameters etc.:<a class="headerlink" href="#get-additional-product-parameters-etc" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get additional product parameters:</span>
<span class="n">product_paras</span> <span class="o">=</span> <span class="n">get_product_paras</span><span class="p">(</span><span class="n">product_id</span><span class="p">)</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="n">main_product</span>             <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
   <span class="n">xghg_str1</span>                <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
   <span class="n">xghg_str2</span>                <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
   <span class="n">prod_format</span>              <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
   <span class="n">prod_file_id</span>             <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
   <span class="n">sensor_and_algorithm_str</span> <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
   <span class="n">product_variable</span>         <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
   <span class="n">prod_year_start</span>          <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
   <span class="n">prod_year_end</span>            <span class="o">=</span> <span class="n">product_paras</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>

<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Product parameters:&#39;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* main_product: &#39;</span><span class="p">,</span> <span class="n">main_product</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* product_id: &#39;</span><span class="p">,</span> <span class="n">product_id</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* product_ver: &#39;</span><span class="p">,</span> <span class="n">product_ver</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* prod_file_id: &#39;</span><span class="p">,</span> <span class="n">prod_file_id</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* sensor_and_algorithm_str: &#39;</span><span class="p">,</span> <span class="n">sensor_and_algorithm_str</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* prod_year_start: &#39;</span><span class="p">,</span> <span class="n">prod_year_start</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* prod_year_end: &#39;</span><span class="p">,</span> <span class="n">prod_year_end</span><span class="p">)</span>

<span class="n">wanted_date_OK</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="n">year_str</span>  <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
   <span class="n">month_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
     <span class="n">month_str</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">month_str</span>
   <span class="n">day_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">day</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
      <span class="n">day_str</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">day_str</span>
<span class="n">wanted_date</span> <span class="o">=</span> <span class="n">year_str</span><span class="o">+</span><span class="n">month_str</span><span class="o">+</span><span class="n">day_str</span>

<span class="k">if</span> <span class="p">((</span><span class="n">year</span> <span class="o">&lt;</span> <span class="n">prod_year_start</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">year</span> <span class="o">&gt;</span> <span class="n">prod_year_end</span><span class="p">)):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: Data for selected date not available for selected product&#39;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*          Selected date: &#39;</span><span class="p">,</span> <span class="n">wanted_date</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*          Availability (years): &#39;</span><span class="p">,</span> <span class="n">prod_year_start</span><span class="p">,</span> <span class="s1">&#39; - &#39;</span><span class="p">,</span> <span class="n">prod_year_end</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="n">wanted_date_OK</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">product_str</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">product_ver</span>

<span class="c1"># Set some parameters etc.:</span>
<span class="n">slash</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span> <span class="c1"># windows</span>
<span class="c1">#slash = &#39;/&#39; # linux</span>

<span class="n">in_file</span>  <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">slash</span><span class="o">+</span><span class="s1">&#39;L2_files&#39;</span><span class="o">+</span><span class="n">slash</span><span class="o">+</span><span class="n">product_id</span><span class="o">+</span><span class="n">slash</span><span class="o">+</span><span class="n">wanted_date</span><span class="o">+</span><span class="n">prod_file_id</span><span class="o">+</span><span class="s1">&#39;v&#39;</span><span class="o">+</span><span class="n">product_ver</span><span class="o">+</span><span class="s1">&#39;.nc&#39;</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Input file: To be downloaded or exists already:&#39;</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* in_file: &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
    
<span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
   <span class="n">xghg_unit</span>  <span class="o">=</span> <span class="s1">&#39;ppm&#39;</span>
   <span class="n">xghg_str</span>   <span class="o">=</span> <span class="s1">&#39;Carbon dioxide&#39;</span>
   <span class="n">xghg_str3</span>  <span class="o">=</span> <span class="s1">&#39;CO2&#39;</span>
   <span class="n">satellite_product_str</span> <span class="o">=</span> <span class="s1">&#39;satellite-carbon-dioxide&#39;</span>
<span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
   <span class="n">xghg_unit</span>  <span class="o">=</span> <span class="s1">&#39;ppb&#39;</span>
   <span class="n">xghg_str</span>   <span class="o">=</span> <span class="s1">&#39;Methane&#39;</span>
   <span class="n">xghg_str3</span>  <span class="o">=</span> <span class="s1">&#39;CH4&#39;</span>
   <span class="n">satellite_product_str</span> <span class="o">=</span> <span class="s1">&#39;satellite-methane&#39;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Product parameters:
* main_product:  XCO2
* product_id:  XCO2_EMMA
* product_ver:  4.4
* prod_file_id:  -C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-
* sensor_and_algorithm_str:  merged_emma
* prod_year_start:  2003
* prod_year_end:  2021
Input file: To be downloaded or exists already:
* in_file:  .\L2_files\XCO2_EMMA\20200915-C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-v4.4.nc
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-data-from-cds-if-needed">
<h2>Download data from CDS if needed:<a class="headerlink" href="#download-data-from-cds-if-needed" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">in_file_exists</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="n">wanted_date_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">do_download_L2_data_via_cdsapi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">pass</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Getting data from CDS ...&#39;</span><span class="p">)</span>
      <span class="c1"># -------------------------------------------------</span>
      <span class="c1">#import cdsapi</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
      <span class="n">c</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
       <span class="n">satellite_product_str</span><span class="p">,</span>
       <span class="p">{</span>
          <span class="s1">&#39;processing_level&#39;</span><span class="p">:</span> <span class="s1">&#39;level_2&#39;</span><span class="p">,</span>
          <span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="n">product_variable</span><span class="p">,</span>
          <span class="s1">&#39;sensor_and_algorithm&#39;</span><span class="p">:</span> <span class="n">sensor_and_algorithm_str</span><span class="p">,</span>
          <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year_str</span><span class="p">,</span>
          <span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="n">month_str</span><span class="p">,</span>
          <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">day_str</span><span class="p">,</span>
          <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="n">product_ver</span><span class="p">,</span>
          <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="s1">&#39;download.zip&#39;</span><span class="p">)</span>
      <span class="c1"># -------------------------------------------------</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ... finished getting data from CDS&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="c1"># Check if wanted satellite input file exists:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Trying to read input file: &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)):</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Input file exists ...&#39;</span><span class="p">)</span>
         <span class="n">in_file_exists</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: Input file does NOT exist !?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* Trying to read input file:  .\L2_files\XCO2_EMMA\20200915-C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-v4.4.nc
* Input file exists ...
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-daily-data-from-l2-file">
<h2>Get daily data from L2 file:<a class="headerlink" href="#get-daily-data-from-l2-file" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get daily data from L2 file:</span>
<span class="n">L2_data_OK</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">in_file_exists</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
   <span class="c1"># Get good quality data for each single ground pixel:</span>
   <span class="n">sat_data</span><span class="p">,</span> <span class="n">pre_lev</span><span class="p">,</span> <span class="n">pre_wei</span><span class="p">,</span> <span class="n">gas_apri</span><span class="p">,</span> <span class="n">gas_ak</span><span class="p">,</span> <span class="n">emma_pro_str</span> <span class="o">=</span> <span class="n">read_L2_file</span><span class="p">(</span><span class="n">main_product</span><span class="p">,</span> <span class="n">prod_format</span><span class="p">,</span> <span class="n">in_file</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">product_id</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">sat_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No good satellite data found&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCO2_EMMA&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCH4_EMMA&#39;</span><span class="p">)):</span> 
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Used individual sensor products for merged EMMA product:&#39;</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="n">emma_pro_str</span><span class="p">)</span>
      <span class="n">L2_data_OK</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">year_str</span>  <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
      <span class="n">month_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
         <span class="n">month_str</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">month_str</span>
      <span class="n">day_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">day</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
         <span class="n">day_str</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span><span class="o">+</span><span class="n">day_str</span>
      <span class="n">date_str</span> <span class="o">=</span> <span class="n">year_str</span><span class="o">+</span><span class="n">month_str</span><span class="o">+</span><span class="n">day_str</span>
      <span class="n">ghg</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sat_data</span><span class="o">.</span><span class="n">gas</span><span class="p">)</span>     <span class="c1"># CO2 in ppm or CH4 in ppb</span>
      <span class="n">ghg_unc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sat_data</span><span class="o">.</span><span class="n">gas_err</span><span class="p">)</span> <span class="c1"># 1-sigma uncertainty (in ppm or ppb)</span>
      <span class="n">lat</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sat_data</span><span class="o">.</span><span class="n">latc</span><span class="p">)</span>    <span class="c1"># Ground pixel center latitude</span>
      <span class="n">lon</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sat_data</span><span class="o">.</span><span class="n">lonc</span><span class="p">)</span>    <span class="c1"># Ground pixel center longitude   </span>
      <span class="n">emma_pro_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sat_data</span><span class="o">.</span><span class="n">emma_pro_id</span><span class="p">)</span>    <span class="c1"># Median product number from EMMA file  </span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* read_L2_file: Trying to read:  .\L2_files\XCO2_EMMA\20200915-C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-v4.4.nc
* read_L2_file: reading:  .\L2_files\XCO2_EMMA\20200915-C3S-L2_GHG-GHG_PRODUCTS-MERGED-MERGED-EMMA-DAILY-v4.4.nc
* read_L2_file: nn_read:  5455
* read_L2_file: nn_good:  5455
* ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Used individual sensor products for merged EMMA product:
   ID   Institute  Instrument   Algorithm     Version
    3        NIES       GOSAT        NIES    v02.9xbc
    6         UoL       GOSAT      UoL-FP        v7.3
    8         IUP       GOSAT       FOCAL        v3.0
    9        NASA       OCO-2        NASA       v10.2
   10         IUP       OCO-2       FOCAL         v10
   12        SRON     GOSAT-2     RemoTeC      v2.0.0
   13         IUP     GOSAT-2       FOCAL        v3.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-daily-data-as-a-function-of-latitude">
<h2>Plot daily data as a function of latitude:<a class="headerlink" href="#plot-daily-data-as-a-function-of-latitude" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot daily data as a function of latitude</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span> <span class="c1"># seaborn style for plots</span>
<span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
<span class="c1">#plot_type = &#39;screen&#39;</span>

<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">L2_data_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   
      <span class="c1"># Compute mean and standard deviation for each latitude band:</span>
      <span class="n">d_lat</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># width of lat band in deg: +/- d_lat</span>
      <span class="n">lb_lats</span>    <span class="o">=</span> <span class="p">[]</span>
      <span class="n">lb_ghg</span>     <span class="o">=</span> <span class="p">[]</span>
      <span class="n">lb_ghg_std</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="o">+</span><span class="n">d_lat</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="n">d_lat</span><span class="o">*</span><span class="mi">2</span><span class="p">):</span>
         <span class="n">act_lat</span> <span class="o">=</span> <span class="n">ii</span>
         <span class="n">idg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">act_lat</span><span class="o">-</span><span class="n">d_lat</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">act_lat</span><span class="o">+</span><span class="n">d_lat</span><span class="p">))</span>
         <span class="n">sel</span> <span class="o">=</span> <span class="n">ghg</span><span class="p">[</span><span class="n">idg</span><span class="p">];</span> <span class="n">len_sel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
         <span class="c1">#print(&#39;* len_sel: &#39;, len_sel)</span>
         <span class="n">lb_lats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_lat</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">len_sel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mean_ghg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">std_ghg</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">lb_ghg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mean_ghg</span><span class="p">)</span>
            <span class="n">lb_ghg_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std_ghg</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">lb_ghg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">999.999</span><span class="p">)</span>
            <span class="n">lb_ghg_std</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">999.999</span><span class="p">)</span>
      <span class="n">lb_lats</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lb_lats</span><span class="p">)</span>
      <span class="n">lb_ghg</span>     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lb_ghg</span><span class="p">)</span>
      <span class="n">lb_ghg_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lb_ghg_std</span><span class="p">)</span>
      <span class="n">idg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lb_ghg_std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">lb_lats</span>    <span class="o">=</span> <span class="n">lb_lats</span><span class="p">[</span><span class="n">idg</span><span class="p">]</span>
      <span class="n">lb_ghg</span>     <span class="o">=</span> <span class="n">lb_ghg</span><span class="p">[</span><span class="n">idg</span><span class="p">]</span>
      <span class="n">lb_ghg_std</span> <span class="o">=</span> <span class="n">lb_ghg_std</span><span class="p">[</span><span class="n">idg</span><span class="p">]</span>
   
      <span class="c1"># Plot data:</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">xxx</span> <span class="o">=</span> <span class="n">ghg</span>
         <span class="n">yyy</span> <span class="o">=</span> <span class="n">lat</span>
         <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.09</span><span class="p">,</span><span class="mf">0.11</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.83</span><span class="p">]</span>     <span class="c1"># pos (l,b,w,h) in page coord</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lb_ghg</span><span class="p">,</span> <span class="n">lb_lats</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lb_ghg</span><span class="o">-</span><span class="n">lb_ghg_std</span><span class="p">,</span> <span class="n">lb_lats</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="c1"># linestyle=&#39;dashed&#39;</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lb_ghg</span><span class="o">+</span><span class="n">lb_ghg_std</span><span class="p">,</span> <span class="n">lb_lats</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
         <span class="n">title</span> <span class="o">=</span> <span class="n">xghg_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">product_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">date_str</span>
         <span class="n">x_label</span> <span class="o">=</span> <span class="n">xghg_str2</span>
         <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Latitude [deg]&#39;</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
            <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39;_latitude.png&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No data for latitude plot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* generating:  XCO2_EMMA_latitude.png
</pre></div>
</div>
<img alt="../_images/145216ba7404a2af163a5f3c2e3b80574749eb3a657f1f548a64072fc2d26ff3.png" src="../_images/145216ba7404a2af163a5f3c2e3b80574749eb3a657f1f548a64072fc2d26ff3.png" />
</div>
</div>
</section>
<section id="plot-data-on-a-map">
<h2>Plot data on a map:<a class="headerlink" href="#plot-data-on-a-map" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define spatial region of interest:</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">20.0</span>
   <span class="n">lonmax</span> <span class="o">=</span>  <span class="mf">50.0</span>
   <span class="n">latmin</span> <span class="o">=</span>  <span class="mf">25.0</span>
   <span class="n">latmax</span> <span class="o">=</span>  <span class="mf">65.0</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
   <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">177.0</span>
   <span class="n">lonmax</span> <span class="o">=</span>  <span class="mf">177.0</span>
   <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">85.0</span>
   <span class="n">latmax</span> <span class="o">=</span>  <span class="mf">85.0</span>
<span class="k">if</span> <span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;CO2_AIR_NLIS&#39;</span><span class="p">:</span>
   <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">130.0</span>
   <span class="n">lonmax</span> <span class="o">=</span>  <span class="mf">130.0</span>
   <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">50.0</span>
   <span class="n">latmax</span> <span class="o">=</span>  <span class="mf">50.0</span>
   
<span class="k">if</span> <span class="n">L2_data_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   
   <span class="c1"># Select data for spatial region of interest:</span>
   <span class="n">idg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">latmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">latmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="n">lonmax</span><span class="p">))</span>
   <span class="n">len_idg</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   
   <span class="n">do_use_all</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">len_idg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: no data found for map for region of interest&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*          ... plotting global data ...&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">do_use_all</span> <span class="o">=</span> <span class="mi">1</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.0</span>
            <span class="n">lonmax</span> <span class="o">=</span>  <span class="mf">180.0</span>
            <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.0</span>
            <span class="n">latmax</span> <span class="o">=</span>  <span class="mf">90.0</span>
      
<span class="k">if</span> <span class="n">L2_data_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      
   <span class="k">if</span> <span class="n">do_use_all</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">lat_sel</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="n">idg</span><span class="p">]</span> 
      <span class="n">lon_sel</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="n">idg</span><span class="p">]</span> 
      <span class="n">ghg_sel</span> <span class="o">=</span> <span class="n">ghg</span><span class="p">[</span><span class="n">idg</span><span class="p">]</span> 
   <span class="k">else</span><span class="p">:</span>
      <span class="n">lat_sel</span> <span class="o">=</span> <span class="n">lat</span>
      <span class="n">lon_sel</span> <span class="o">=</span> <span class="n">lon</span>
      <span class="n">ghg_sel</span> <span class="o">=</span> <span class="n">ghg</span>

   <span class="c1"># Plot title:</span>
   <span class="n">title</span> <span class="o">=</span> <span class="n">xghg_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">product_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">date_str</span>

   <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">rmin</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ghg_sel</span><span class="p">)</span>
         <span class="n">rmax</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ghg_sel</span><span class="p">)</span>
         <span class="n">ndata</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ghg_sel</span><span class="p">)</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="c1">#figsize = (8,5)</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
               <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
               <span class="n">nc_rows</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">nc_cols</span> <span class="o">=</span> <span class="mi">1</span>
               <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">nc_rows</span><span class="p">,</span> <span class="n">nc_cols</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
               <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.84</span><span class="p">,</span><span class="mf">0.68</span><span class="p">]</span>     <span class="c1"># pos (l,b,w,h) in page coord</span>
               <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;powderblue&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Latitude [deg]&#39;</span>
            <span class="n">y_label</span> <span class="o">=</span> <span class="s1">&#39;Longitude [deg]&#39;</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">drawmeridians_label</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">draw_labels</span><span class="o">=</span><span class="n">drawmeridians_label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="c1">#gl.xlabels_top = False</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>  <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># ----------------------------------------</span>
            <span class="c1"># Set colors:</span>
            <span class="n">cp_name</span> <span class="o">=</span> <span class="s1">&#39;viridis&#39;</span>
            <span class="n">scmap</span>   <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cp_name</span><span class="p">)</span>
            <span class="n">colors</span>  <span class="o">=</span> <span class="n">scmap</span><span class="o">.</span><span class="n">colors</span>        
            <span class="n">cc_all</span> <span class="o">=</span> <span class="n">mb_set_colors</span><span class="p">(</span><span class="n">colors</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">ghg_sel</span><span class="p">)</span>
            <span class="c1"># ----------------------------------------</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
               <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndata</span><span class="p">):</span>
                  <span class="n">act_lat</span>   <span class="o">=</span> <span class="n">lat_sel</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                  <span class="n">act_lon</span>   <span class="o">=</span> <span class="n">lon_sel</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                  <span class="n">act_color</span> <span class="o">=</span> <span class="n">cc_all</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
                  <span class="c1">#max_area = 40.0</span>
                  <span class="c1">#act_area =  data[ii]/rmax * max_area</span>
                  <span class="n">act_area</span> <span class="o">=</span> <span class="mf">20.0</span>
                  <span class="n">zorder_data</span> <span class="o">=</span> <span class="mi">100</span>
                  <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
                  <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                     <span class="k">if</span> <span class="n">act_area</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">act_lon</span><span class="p">,</span> <span class="n">act_lat</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">act_color</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">act_area</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cp_name</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder_data</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
               <span class="c1"># ----------------------------------------</span>
               <span class="n">do_cb</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># Add color bar</span>
               <span class="k">if</span> <span class="n">do_cb</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>                 
                  <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span>
                  <span class="n">cb_scale_y</span>  <span class="o">=</span> <span class="mf">2.0</span>
                  <span class="n">cb_cy_shift</span> <span class="o">=</span> <span class="o">+</span><span class="mf">0.05</span>
                  <span class="n">axpos</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
                  <span class="n">cax_width</span>  <span class="o">=</span> <span class="mf">0.60</span><span class="o">*</span><span class="n">axpos</span><span class="o">.</span><span class="n">width</span>
                  <span class="n">cax_height</span> <span class="o">=</span> <span class="mf">0.03</span><span class="o">*</span><span class="n">axpos</span><span class="o">.</span><span class="n">height</span> <span class="o">*</span> <span class="n">cb_scale_y</span>
                  <span class="n">pos_x</span> <span class="o">=</span> <span class="n">axpos</span><span class="o">.</span><span class="n">x0</span> <span class="o">+</span> <span class="mf">0.20</span><span class="o">*</span><span class="n">axpos</span><span class="o">.</span><span class="n">width</span>
                  <span class="n">pos_y</span> <span class="o">=</span> <span class="n">axpos</span><span class="o">.</span><span class="n">y0</span> <span class="o">-</span> <span class="mf">4.2</span><span class="o">*</span><span class="n">cax_height</span> <span class="o">+</span> <span class="n">cb_cy_shift</span>
                  <span class="n">pos_cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">pos_x</span><span class="p">,</span><span class="n">pos_y</span><span class="p">,</span><span class="n">cax_width</span><span class="p">,</span><span class="n">cax_height</span><span class="p">])</span>
                  <span class="n">pos_cax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">main_product</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">xghg_unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                  <span class="n">cb_extend</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
                  <span class="n">norm</span><span class="o">=</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">rmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">rmax</span><span class="p">)</span>
                  <span class="n">dr</span> <span class="o">=</span> <span class="p">(</span><span class="n">rmax</span><span class="o">-</span><span class="n">rmin</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
                  <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmin</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="n">dr</span><span class="p">,</span> <span class="n">rmin</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dr</span><span class="p">,</span> <span class="n">rmin</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">dr</span><span class="p">,</span> <span class="n">rmin</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">dr</span><span class="p">]</span>
                  <span class="n">bounds_str</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">char</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.1f</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="p">)</span>
                  <span class="n">cb1</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">pos_cax</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cp_name</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> 
                            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="n">cb_extend</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
                  <span class="n">cb1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">bounds_str</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
               <span class="c1"># ----------------------------------------</span>
            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
               <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39;_map.png&#39;</span>
               <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No data for map (1) !&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No data for map (2) !&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No data for map (3) !&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* generating:  XCO2_EMMA_map.png
</pre></div>
</div>
<img alt="../_images/2f45de44b73bd6dd0724947b8cf071c1c71d1e5fa76037896be329fad6c47458.png" src="../_images/2f45de44b73bd6dd0724947b8cf071c1c71d1e5fa76037896be329fad6c47458.png" />
</div>
</div>
</section>
<section id="plot-a-priori-profile-and-averaging-kernel">
<h2>Plot a priori profile and averaging kernel:<a class="headerlink" href="#plot-a-priori-profile-and-averaging-kernel" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot a priori profile and averaging kernel for one selected ground pixel</span>

<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">L2_data_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="o">=</span> <span class="n">xghg_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">product_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">date_str</span>
      <span class="n">n_data</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ghg</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* n_data: &#39;</span><span class="p">,</span> <span class="n">n_data</span><span class="p">)</span>
      <span class="n">grd_px_OK</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="n">n_data</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No data for averaging kernel plot&#39;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">grd_px_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_data</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1">#grd_px_idx = 900</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Define region of interest:</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
               <span class="n">idx_px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mf">25.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mf">35.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="mf">30.0</span><span class="p">))</span> <span class="c1"># Northern Africa</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
               <span class="n">la_c</span> <span class="o">=</span> <span class="mf">30.450</span><span class="p">;</span> <span class="n">lo_c</span> <span class="o">=</span> <span class="mf">26.900</span><span class="p">;</span> <span class="n">dd</span> <span class="o">=</span> <span class="mf">0.1</span>  
               <span class="n">idx_px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">la_c</span><span class="o">-</span><span class="n">dd</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">la_c</span><span class="o">+</span><span class="n">dd</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="n">lo_c</span><span class="o">-</span><span class="n">dd</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="n">lo_c</span><span class="o">+</span><span class="n">dd</span><span class="p">))</span> <span class="c1"># Test</span>
            <span class="c1"># idx_px: tuple object</span>
            <span class="c1">#grd_px_idx = idx_px[0][0]</span>
            <span class="c1"># May happen: IndexError: index 0 is out of bounds for axis 0 with size 0</span>
            <span class="c1">#if any(idx_px) == True:</span>
            <span class="n">len_idx_px</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_px</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#print(&#39;* len_idx_px: &#39;, len_idx_px)</span>
            <span class="k">if</span> <span class="n">len_idx_px</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
               <span class="n">grd_px_idx</span> <span class="o">=</span> <span class="n">idx_px</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">grd_px_OK</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="c1">#grd_px_OK = 0</span>
               <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No ground pixel found for averaging kernel plot for region of interest&#39;</span><span class="p">)</span>
               <span class="n">len_lat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
               <span class="k">if</span> <span class="n">len_lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                  <span class="n">grd_px_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_data</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                  <span class="k">if</span> <span class="n">grd_px_idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                     <span class="n">grd_px_idx</span> <span class="o">=</span> <span class="mi">0</span>
               <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;           Using data for other region ...&#39;</span><span class="p">)</span>
               <span class="n">grd_px_OK</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">grd_px_OK</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No ground pixel found for averaging kernel plot&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grd_px_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span> 
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Selected ground pixel: index: &#39;</span><span class="p">,</span> <span class="n">grd_px_idx</span><span class="p">)</span>
         <span class="n">act_lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">]</span>
         <span class="n">act_lon</span> <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">]</span>
         <span class="n">act_ghg</span> <span class="o">=</span> <span class="n">ghg</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">]</span>
         <span class="n">act_emma_pro_id</span> <span class="o">=</span> <span class="n">emma_pro_id</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">]</span>
         <span class="n">act_emma_pro_id_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">act_emma_pro_id</span><span class="p">)</span>
         <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* lat lon ghg: &#39;</span><span class="p">,</span> <span class="n">act_lat</span><span class="p">,</span> <span class="n">act_lon</span><span class="p">,</span> <span class="n">act_ghg</span><span class="p">)</span>
         <span class="n">act_lat_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act_lat</span><span class="p">)</span>
         <span class="n">act_lon_str</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act_lon</span><span class="p">)</span>
         <span class="n">sub_title</span> <span class="o">=</span> <span class="n">title</span><span class="o">+</span><span class="s1">&#39; (lat=&#39;</span><span class="o">+</span><span class="n">act_lat_str</span><span class="o">+</span><span class="s1">&#39;, lon=&#39;</span><span class="o">+</span><span class="n">act_lon_str</span><span class="o">+</span><span class="s1">&#39;)&#39;</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* pre_lev.shape: &#39;</span><span class="p">,</span> <span class="n">pre_lev</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* gas_apri.shape: &#39;</span><span class="p">,</span> <span class="n">gas_apri</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* gas_ak.shape: &#39;</span><span class="p">,</span> <span class="n">gas_ak</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
         <span class="n">p_apri</span>  <span class="o">=</span> <span class="n">gas_apri</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">,</span> <span class="p">:]</span>
         <span class="n">p_ak</span>    <span class="o">=</span> <span class="n">gas_ak</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">,</span> <span class="p">:]</span>
         <span class="n">p_press</span> <span class="o">=</span> <span class="n">pre_lev</span><span class="p">[</span><span class="n">grd_px_idx</span><span class="p">,</span> <span class="p">:]</span>
         <span class="n">n_lay</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_apri</span><span class="p">)</span>  <span class="c1"># layer (m)</span>
         <span class="n">n_mpx</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_press</span><span class="p">)</span> <span class="c1"># level (m+1) or layer (m) </span>
         <span class="k">if</span> <span class="n">n_mpx</span> <span class="o">&gt;</span> <span class="n">n_lay</span><span class="p">:</span>
            <span class="n">p_press_tmp1</span> <span class="o">=</span> <span class="n">p_press</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_lay</span><span class="p">]</span>
            <span class="n">p_press_tmp2</span> <span class="o">=</span> <span class="n">p_press</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">n_lay</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">p_press</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">p_press_tmp1</span> <span class="o">+</span> <span class="n">p_press_tmp2</span><span class="p">)</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">p_press</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p_press</span><span class="p">)</span>
            <span class="n">p_apri</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p_apri</span><span class="p">)</span>
            <span class="n">p_ak</span>    <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">p_ak</span><span class="p">)</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># --------------------------------------------</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">sub_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prod_format</span> <span class="o">!=</span> <span class="s1">&#39;cci_iasi&#39;</span><span class="p">:</span>
               <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_apri</span><span class="p">,</span> <span class="n">p_press</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
               <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p_apri</span><span class="p">,</span> <span class="n">p_press</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;No profile available&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_ak</span><span class="p">,</span>   <span class="n">p_press</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">p_ak</span><span class="p">,</span>   <span class="n">p_press</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;A priori profile&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure [hPa]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xghg_str3</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">xghg_unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Averaging kernel&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;AK [-]&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCO2_EMMA&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">product_id</span> <span class="o">==</span> <span class="s1">&#39;XCH4_EMMA&#39;</span><span class="p">)):</span>
               <span class="n">p1</span> <span class="o">=</span> <span class="n">emma_pro_str</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">act_emma_pro_id_str</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
               <span class="n">s1</span> <span class="o">=</span> <span class="n">emma_pro_str</span><span class="p">[</span><span class="n">p1</span><span class="p">:</span><span class="n">p1</span><span class="o">+</span><span class="mi">70</span><span class="p">]</span>
               <span class="n">p2</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span>
               <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">p2</span><span class="p">]</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s1">&#39;Indiv.sensor product ID: &#39;</span><span class="o">+</span><span class="n">act_emma_pro_id_str</span><span class="o">+</span><span class="s1">&#39; (&#39;</span><span class="o">+</span><span class="n">s2</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">transFigure</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
               <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">product_id</span><span class="o">+</span><span class="s1">&#39;_ak.png&#39;</span>
               <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="c1"># --------------------------------------------</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Warning: No data for averaging kernel plot&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* n_data:  5455
* Selected ground pixel: index:  2370
* lat lon ghg:  30.449978 26.900187 410.57593
* pre_lev.shape:  (5455, 11)
* gas_apri.shape:  (5455, 10)
* gas_ak.shape:  (5455, 10)
* generating:  XCO2_EMMA_ak.png
</pre></div>
</div>
<img alt="../_images/264afbcf762e7d4f61c92e515b6afd04dfeec8050df2f8e321f94e869478a719.png" src="../_images/264afbcf762e7d4f61c92e515b6afd04dfeec8050df2f8e321f94e869478a719.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ecv-notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

            </article>
            

            
            
            <footer class="bd-footer-article">
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
  <a class='left-prev' id="prev-link" href="lake-surface-water-temperature.html" title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
          <p class="prev-next-subtitle">previous</p>
          <p class="prev-next-title">Visualising Lake Surface Water Temperature (LSWT) as timeseries at one location on a given lake and the spatial distribution of the LSWT for a given day</p>
      </div>
  </a>
  <a class='right-next' id="next-link" href="greenhouse-gases-level3-products.html" title="next page">
  <div class="prev-next-info">
      <p class="prev-next-subtitle">next</p>
      <p class="prev-next-title">How to access, read and process satellite XCO2 and XCH4 Level 3 data products</p>
  </div>
  <i class="fa-solid fa-angle-right"></i>
  </a>
</div>
            </footer>
            
          </div>
          
          
          
            <div class="bd-sidebar-secondary bd-toc">
              
<div class="toc-item">
  
<div class="tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
</div>
<nav id="bd-toc-nav" class="page-toc">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-get-the-satellite-data-products">
   How to get the satellite data products:
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-download-from-the-cds-via-the-cdsapi">
     Data download from the CDS via the cdsapi:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#how-to-access-read-and-process-the-satellite-data-with-python">
   How to access, read and process the satellite data with Python:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports">
   Imports:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#functions">
   Functions:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-user-input">
   Initial user input:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-additional-product-parameters-etc">
   Get additional product parameters etc.:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#download-data-from-cds-if-needed">
   Download data from CDS if needed:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#get-daily-data-from-l2-file">
   Get daily data from L2 file:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-daily-data-as-a-function-of-latitude">
   Plot daily data as a function of latitude:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-data-on-a-map">
   Plot data on a map:
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-a-priori-profile-and-averaging-kernel">
   Plot a priori profile and averaging kernel:
  </a>
 </li>
</ul>

</nav>
</div>

            </div>
          
          
        </div>
        <footer class="bd-footer-content">
          <div class="bd-footer-content__inner">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    
<p class="copyright">

    &copy; Copyright 2022.<br>

</p>

  </div>
  
  <div class="footer-item">
    <p class="last-updated">
Last updated on None.<br>
</p>
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </div>
        </footer>
        

      </main>
    </div>
  </div>

  
    
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=796348d33e8b1d947c94"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=796348d33e8b1d947c94"></script>

  </body>
</html>