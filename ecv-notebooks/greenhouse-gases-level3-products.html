
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>How to access, read and use satellite XCO2 and XCH4 Level 3 data products &#8212; C3S Training</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ecv-notebooks/greenhouse-gases-level3-products';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Exploring gridded data on Aerosol properties available on C3S" href="aerosol-single-sensor-demonstrator.html" />
    <link rel="prev" title="How to access and use a satellite-derived GHG Level 2 data product using XCO2_EMMA as an example?" href="greenhouse-gases-level2-products.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="C3S Training - Home"/>
    <script>document.write(`<img src="../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="C3S Training - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Copernicus Climate Change Service (C3S) Data Tutorials
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Climate Data Store (CDS)</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cds-tutorial.html">CDS tutorial</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reanalysis Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../reanalysis-climatology.html">Climatology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reanalysis-heatwave.html">Heatwave Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../projections-cmip6.html">Climate Projections (CMIP6)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../projections-cordex.html">Climate Projections (CORDEX)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../sf-anomalies.html">Seasonal Forecast Anomalies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sf-verification.html">Seasonal Forecast Verification</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Climate Indices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../ci-windchill.html">Windchill Index Calculation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials using Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="erb-outgoing-longwave-radiation.html">Outgoing Longwave Radiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="erb-clara-climatology.html">Analysis of the CLARA Earth radiation budget product</a></li>
<li class="toctree-l1"><a class="reference internal" href="erb-ceres-climatology.html">Analysis of the CERES Earth radiation budget product</a></li>
<li class="toctree-l1"><a class="reference internal" href="total-solar-irradiance.html">Total Solar Irradiance</a></li>
<li class="toctree-l1"><a class="reference internal" href="srb-climatology-and-anomaly.html">Surface radiation budget climatologies and anomalies</a></li>
<li class="toctree-l1"><a class="reference internal" href="total-column-water-vapour-combi.html">Total column water vapour</a></li>
<li class="toctree-l1"><a class="reference internal" href="tropospheric-humidity-from-radio-occultation.html">Tropospheric humidity estimates from satellite-based radio occultation measurements</a></li>
<li class="toctree-l1"><a class="reference internal" href="cloud-cover-climatology.html">Cloud fractional cover climatology</a></li>
<li class="toctree-l1"><a class="reference internal" href="greenhouse-gases-level2-products.html">Greenhouse Gas Level 2 Products</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">How to access, read and use satellite XCO2 and XCH4 Level 3 data products</a></li>


<li class="toctree-l1"><a class="reference internal" href="aerosol-single-sensor-demonstrator.html">Exploring gridded data on Aerosol properties available on C3S</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerosol-multi-sensor-record.html">Visualising a full Climate Data Record of multi-sensor Aerosol data</a></li>


<li class="toctree-l1"><a class="reference internal" href="total-ozone-columns.html">Exploring an ozone product available through the Climate Data Store (CDS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="soil-moisture-anomalies.html"><strong>C3S Soil Moisture Data Access and Anomaly Analysis Notebook</strong></a></li>

<li class="toctree-l1"><a class="reference internal" href="lake-water-level.html">Tutorial: Data Access and  Visualisation of Lake Water Level (LWL) timeseries</a></li>




<li class="toctree-l1"><a class="reference internal" href="lake-surface-water-temperature.html">Visualisation of Lake Surface Water Temperature (LSWT) data for a given lake</a></li>




<li class="toctree-l1"><a class="reference internal" href="viewer-for-sealevel-product.html">Looking at Sea Level data during an El Niño episode</a></li>
<li class="toctree-l1"><a class="reference internal" href="ice-sheet-surface-elevation.html">Ice sheet surface elevation change rates</a></li>
<li class="toctree-l1"><a class="reference internal" href="ice-sheet-velocity.html">Access and visualisation of the Greenland Ice Sheet velocity data</a></li>
<li class="toctree-l1"><a class="reference internal" href="ice-sheet-mass-balance.html">Exploring Ice sheet Gravimetric Mass Balance data, available through the C3S Climate Data Store</a></li>





<li class="toctree-l1"><a class="reference internal" href="glacier-area.html">Explore glacier area</a></li>
<li class="toctree-l1"><a class="reference internal" href="glacier-mass-change.html">Glacier mass change</a></li>
<li class="toctree-l1"><a class="reference internal" href="mean-with-inverse-variance-weights.html">Computing the time average of LAI and fAPAR using inverse variance weights</a></li>

<li class="toctree-l1"><a class="reference internal" href="precipitation-giraffe.html">Exploring Precipitation information in the GIRAFE dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Turorials using Copernicus Emergency Management Service data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../cems-notebooks/visualising-fwi-for-esotc.html">Visualising fire weather index (FWI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cems-notebooks/glofas-bangladesh-floods.html">Observing major flood events</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorials on Bias Correction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://ibicus.readthedocs.io/en/latest/getting_started/overview.html">Python library (ibicus) and tutorials on bias correction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Atmosphere Monitoring Tutorials</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference external" href="https://ecmwf-projects.github.io/copernicus-training-cams/">Tutorials from the Copernicus Atmosphere Monitoring Service (CAMS)</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/ecmwf-projects/copernicus-training-c3s-review/review?urlpath=tree/ecv-notebooks/greenhouse-gases-level3-products.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/copernicus-training-c3s-review" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/copernicus-training-c3s-review/issues/new?title=Issue%20on%20page%20%2Fecv-notebooks/greenhouse-gases-level3-products.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/ecv-notebooks/greenhouse-gases-level3-products.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>How to access, read and use satellite XCO2 and XCH4 Level 3 data products</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How to access, read and use satellite XCO2 and XCH4 Level 3 data products</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-get-the-satellite-data-products">How to get the satellite data products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-via-the-cds-website">Data download via the CDS website</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-and-process-the-satellite-data-with-python">How to read and process the satellite data with Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-user-input">Initial user input</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-settings">Initial settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-an-obs4mips-file">Reading an OBS4MIPS file</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-1-investigating-time-series-for-latitude-bands">Application 1: Investigating time series for latitude bands</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-2-investigating-spatial-variations-and-coverage">Application 2: Investigating spatial variations and coverage</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>Michael Buchwitz, 7-May-2024</p>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-access-read-and-use-satellite-xco2-and-xch4-level-3-data-products">
<h1>How to access, read and use satellite XCO2 and XCH4 Level 3 data products<a class="headerlink" href="#how-to-access-read-and-use-satellite-xco2-and-xch4-level-3-data-products" title="Link to this heading">#</a></h1>
<p>This is a Jupyter Notebook (JN) illustrating how to access, read and use Greenhouse Gas (GHG) atmospheric carbon dioxide (CO2) and methane (CH4) data products as generated in the framework of the Copernicus Climate Change Service (C3S).</p>
<p>The C3S GHG data products used here are retrieved from satellite radiance measurement using dedicated retrieval algorithms. Most of these algorithms have been developed in the past within the Climate Change Initiative (CCI) of the European Space Agency (ESA). These algorithms are now used to operationally generate the corresponding data products within the European Union (EU) C3S project. The data products are freely available for all interested users from the Copernicus Climate Data Store (CDS,
<a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a>).</p>
<p>Several satellite-derived Essential Climate Variable (ECV) atmospheric data products are generated for GHGs (CO2 and CH4), aerosols and ozone. This JN focusses on GHG Level 3 (L3) products. The other products are covered by separate JNs. The GHG L3 products are available at a spatial resolution of 5 deg latitude times 5 deg longitude and monthly time resolution. In contrast, Level 2 (L2) products contain retrieved parameters for individual satellite ground pixels (footprints). How to use L2 GHG products is described in a separate JN.</p>
<p>The GHG L3 products contain column-averaged dry-air mole fractions of CO2 and CH4, denoted XCO2 (in ppm) and XCH4 (in ppb). They are derived from SCIAMACHY/ENVISAT, GOSAT, GOSAT-2 and OCO-2. The relevant peer-reviewed publication describing the algorithm and an earlier version of the data products is Reuter et al., 2020 (<a class="reference external" href="https://amt.copernicus.org/articles/13/789/2020/">https://amt.copernicus.org/articles/13/789/2020/</a>). The relevant technical documentation and further information is available on the CDS website (<a class="reference external" href="https://cds.climate.copernicus.eu/">https://cds.climate.copernicus.eu/</a>).</p>
<p>The atmospheric concentration of both gases varies in time and in space. This JN focusses on two use cases.</p>
<p>The first use case is related to temporal variations. Temporal atmospheric concentration variations depend, for example, on latitude. Seasonal variations are, for example, different for the northern hemisphere (NH) and the southern hemisphere (SN), whereas the increasing trend is similar for different latitude bands. This can be investigated by generating and plotting time series for latitude bands. How this can be done is shown in this JN.</p>
<p>The second use case is related to spatial variations. Here it is shown how spatial maps of GHG concentrations and their uncertainty can be generated. Depending on time (month, season) XCO2 maps show large differences of the CO2 concentration in the two hemispheres, i.e., a significant interhemispheric CO2 gradient. This is also observed for XCH4. In each hemisphere the concentration of both gases is quite similar as both gases are long lived and well mixed due to atmospheric transport and diffusion. Nevertheless, strong source regions are sometimes (during certain months) directly visible via locally enhanced concentrations.  This can be seen and investigated by generating monthly XCO2 and XCH4 maps. The monthly maps also show the time dependent spatial coverage of the satellite-derived data products. This is primarily due to the fact that these satellite observations require good solar illumination conditions. The spatial coverage therefore closely follows the sun with better coverage of the summer hemisphere compared to the winter hemisphere. Data gaps are also due to clouds (all data are filtered to avoid cloud contamination), water surfaces (oceans and lakes, etc., are poor reflectors of solar radiation in the short-wave infra-red spectral range except for sun-glint observing conditions) and for other reasons. How these spatial maps can be generated is shown in this JN.</p>
<p>The L3 XCO2 data product used here has product identifier (ID) XCO2_OBS4MIPS and the L3 XCH4 product ID is XCH4_OBS4MIPS. The code has been tested using version 4.4 of these products, which covers the period from beginning of 2003 to end of 2021.</p>
<section id="how-to-get-the-satellite-data-products">
<h2>How to get the satellite data products<a class="headerlink" href="#how-to-get-the-satellite-data-products" title="Link to this heading">#</a></h2>
<p>The C3S GHG data products and their documentation are available from the CDS website.</p>
<p>CO2 data and documents are available from <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-carbon-dioxide?tab=overview">https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-carbon-dioxide?tab=overview</a>.</p>
<p>CH4 data and documents are available from <a class="reference external" href="https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-methane?tab=overview">https://cds.climate.copernicus.eu/cdsapp#!/dataset/satellite-methane?tab=overview</a>.</p>
<p>Each satellite-derived CO2 or CH4 data product as generated in C3S and made available via the CDS has a unique product ID. The product IDs of the Level 3 products used here are XCO2_OBS4MIPS and XCH4_OBS4MIPS. Each products consists of a single NetCDF file in Obs4MIPs format (<a class="reference external" href="https://esgf-node.llnl.gov/projects/obs4mips/">https://esgf-node.llnl.gov/projects/obs4mips/</a>). These products have been generated by merging data products from different satellite sensors. On the CDS website these products can be selected and downloaded by selecting “MERGED and OBS4MIPS” for item “Sensor and algorithm” as described in details in the following section.</p>
<section id="data-download-via-the-cds-website">
<h3>Data download via the CDS website<a class="headerlink" href="#data-download-via-the-cds-website" title="Link to this heading">#</a></h3>
<p>Arguably the easiest way to get these data is to download them from the CDS website by clicking on the relevant entries
as provided via the CDS user interface. This can be done as follows:</p>
<p>Goto:
<a class="reference external" href="https://cds.climate.copernicus.eu/#!/home">https://cds.climate.copernicus.eu/#!/home</a></p>
<p>In the following we explain how to obtain the XCO2_OBS4MIPS v4.4 product. Essentially the same method can be used to get the corresponding methane XCH4_OBS4MIPS product or another version of these Level 3 products.</p>
<p>To get the CO2 product: Search for “CO2” in the search field.</p>
<p>Then click on:</p>
<ul class="simple">
<li><p>Carbon dioxide data from 2002 to present derived from satellite observations</p></li>
<li><p>Download data</p></li>
</ul>
<p>Then select:</p>
<ul class="simple">
<li><p>Level 3</p></li>
<li><p>Column-average dry-air mole fraction of atmospheric Carbon Dioxide (XCO2) and related variables</p></li>
<li><p>MERGED and OBS4MIPS</p></li>
<li><p>4.4</p></li>
<li><p>Zip file (.zip)</p></li>
</ul>
<p>Then:</p>
<ul class="simple">
<li><p>Login/register to submit request (use “Create new account”, if needed)</p></li>
<li><p>Click on: Download</p></li>
<li><p>Unzip the file and move it to the current directory.</p></li>
<li><p>Add “XCO2_” at the beginning of the XCO2 filename and “XCH4_” at the beginning of the XCH4 filename.</p></li>
</ul>
<p>Finally, the following two files should be located in the current directory:</p>
<p>XCO2_200301_202112-C3S-L3_GHG-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.4.nc</p>
<p>XCH4_200301_202112-C3S-L3_GHG-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.4.nc</p>
</section>
</section>
<section id="how-to-read-and-process-the-satellite-data-with-python">
<h2>How to read and process the satellite data with Python<a class="headerlink" href="#how-to-read-and-process-the-satellite-data-with-python" title="Link to this heading">#</a></h2>
<p>In the following, Phython 3 code is provided to read and process the satellite data.</p>
<p>It is assumed that Python and Jupyter Notebook (JN) is installed on your computer, e.g., using the Anaconda distribution (<a class="reference external" href="https://www.anaconda.com/products/distribution">https://www.anaconda.com/products/distribution</a>).</p>
<p>The code starts with importing several modules as needed to run this JN.</p>
</section>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">import</span> <span class="nn">juliandate</span> <span class="k">as</span> <span class="nn">jd</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-user-input">
<h2>Initial user input<a class="headerlink" href="#initial-user-input" title="Link to this heading">#</a></h2>
<p>Select the desired product by activating either the line with XCO2 or the line with XCH4 (note that lines starting with “#” are comment lines). Here we have selected XCH4:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select one main_product:</span>
<span class="c1">#main_product = &#39;XCO2&#39;</span>
<span class="n">main_product</span> <span class="o">=</span> <span class="s1">&#39;XCH4&#39;</span>

<span class="c1"># Set input file names, product ID and version number:</span>
<span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
   <span class="n">in_file</span>     <span class="o">=</span> <span class="s1">&#39;XCO2_200301_202112-C3S-L3_GHG-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.4.nc&#39;</span>
   <span class="n">product_ver</span> <span class="o">=</span> <span class="s1">&#39;XCO2_OBS4MIPS v4.4&#39;</span> 
<span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
   <span class="n">in_file</span>     <span class="o">=</span> <span class="s1">&#39;XCH4_200301_202112-C3S-L3_GHG-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.4.nc&#39;</span>
   <span class="n">product_ver</span> <span class="o">=</span> <span class="s1">&#39;XCH4_OBS4MIPS v4.4&#39;</span> 
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* main_product: &#39;</span><span class="p">,</span> <span class="n">main_product</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* main_product:  XCH4
</pre></div>
</div>
</div>
</div>
</section>
<section id="initial-settings">
<h2>Initial settings<a class="headerlink" href="#initial-settings" title="Link to this heading">#</a></h2>
<p>Here some variables are set depending on the selected product:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set units etc.:</span>
<span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
   <span class="n">xghg_unit</span>  <span class="o">=</span> <span class="s1">&#39;ppm&#39;</span>
   <span class="n">xghg_str</span>   <span class="o">=</span> <span class="s1">&#39;Carbon dioxide&#39;</span>
   <span class="n">xghg_str1</span>  <span class="o">=</span> <span class="s1">&#39;XCO$_2$&#39;</span>
   <span class="n">xghg_str2</span>  <span class="o">=</span> <span class="s1">&#39;Column-averaged CO$_2$, XCO$_2$ [ppm]&#39;</span>
<span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
   <span class="n">xghg_unit</span>  <span class="o">=</span> <span class="s1">&#39;ppb&#39;</span>
   <span class="n">xghg_str</span>   <span class="o">=</span> <span class="s1">&#39;Methane&#39;</span>
   <span class="n">xghg_str1</span>  <span class="o">=</span> <span class="s1">&#39;XCH$_4$&#39;</span>
   <span class="n">xghg_str2</span>  <span class="o">=</span> <span class="s1">&#39;Column-averaged CH$_4$, XCH$_4$ [ppb]&#39;</span>
    
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">()</span> <span class="c1"># seaborn style for plots</span>

<span class="c1"># We want to generate plots in png format:</span>
<span class="n">plot_type</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="functions">
<h2>Functions<a class="headerlink" href="#functions" title="Link to this heading">#</a></h2>
<p>Here some functions are defined to simplify the code later used in this JN.</p>
<p>This function helps to simplify the extraction of time information:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert OBS4MIPS start time (first dim of time_bnds) into year and month</span>
<span class="c1"># Input:  o4m_start_time: month start time in days since 01-01-1990</span>
<span class="c1"># Output: year and month for each time index (two 1D arrays with same length as o4m_start_time)</span>
<span class="k">def</span> <span class="nf">get_year_month_from_o4m_time</span><span class="p">(</span><span class="n">o4m_start_time</span><span class="p">):</span>
   <span class="c1">#import datetime</span>
   <span class="c1">#import math</span>
   <span class="c1">#import numpy as np</span>
   <span class="n">o4m_year</span>  <span class="o">=</span> <span class="kc">None</span>
   <span class="n">o4m_month</span> <span class="o">=</span> <span class="kc">None</span>
   <span class="n">o4m_start_time_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">o4m_start_time</span><span class="p">)</span>
   <span class="n">n_times</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">o4m_start_time_np</span><span class="p">)</span>
   <span class="c1">#print(&#39;* n_times: &#39;, n_times)</span>
   <span class="n">jd2_ref</span> <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">from_gregorian</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
   <span class="n">data_ok</span> <span class="o">=</span> <span class="mi">1</span>     <span class="c1"># Assume all is OK</span>
   <span class="n">n_ok</span>    <span class="o">=</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="n">n_times</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">pass</span>
      <span class="n">year</span>  <span class="o">=</span> <span class="p">[]</span>
      <span class="n">month</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="c1"># ----------------------------------</span>
      <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">act_time</span>   <span class="o">=</span> <span class="n">o4m_start_time_np</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
            <span class="n">time_grego</span> <span class="o">=</span> <span class="n">jd2_ref</span> <span class="o">+</span> <span class="n">act_time</span> <span class="o">+</span> <span class="mi">15</span>
            <span class="n">act_date</span>   <span class="o">=</span> <span class="n">jd</span><span class="o">.</span><span class="n">to_gregorian</span><span class="p">(</span><span class="n">time_grego</span><span class="p">)</span>
            <span class="n">act_year</span>   <span class="o">=</span> <span class="n">act_date</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">act_month</span>  <span class="o">=</span> <span class="n">act_date</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#gre_cmp = jd.from_gregorian(act_year, act_month, 1)</span>
            <span class="c1">#print(&#39;* ii act_time yy mm: &#39;, ii, act_time, act_year, act_month)</span>
            <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
               <span class="n">n_ok</span>    <span class="o">=</span> <span class="n">n_ok</span> <span class="o">+</span> <span class="mi">1</span>
               <span class="n">year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_year</span><span class="p">)</span>
               <span class="n">month</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_month</span><span class="p">)</span>
      <span class="c1"># ----------------------------------</span>
      <span class="k">if</span> <span class="n">n_ok</span> <span class="o">!=</span> <span class="n">n_times</span><span class="p">:</span>
         <span class="n">data_ok</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="c1"># generate output arrays if all OK:</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">data_ok</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">year</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="n">month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
            <span class="n">o4m_year</span>  <span class="o">=</span> <span class="n">year</span>
            <span class="n">o4m_month</span> <span class="o">=</span> <span class="n">month</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR in get_year_month_from_o4m_time: unexpected issue: cannot generate year and month arrays&#39;</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">o4m_year</span><span class="p">,</span> <span class="n">o4m_month</span>
</pre></div>
</div>
</div>
</div>
<p>This function is used to read the data files:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read input data:</span>
<span class="c1"># Input: (main_product = &#39;XCO2&#39; or &#39;XCH4&#39;) and OBS4MIPS file name</span>
<span class="c1"># Output: see below</span>
<span class="c1"># Note: Listed numerical values for illustration only </span>
<span class="k">def</span> <span class="nf">read_o4m_file</span><span class="p">(</span><span class="n">main_product</span><span class="p">,</span> <span class="n">in_file</span><span class="p">):</span>
   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* read_o4m_file: Trying to read: &#39;</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
   <span class="c1"># Init output:</span>
   <span class="n">xghg</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># XCO2 (in ppm) or XCH4 (in ppb) in cell</span>
   <span class="n">xghg_unc</span>      <span class="o">=</span> <span class="kc">None</span> <span class="c1"># 1-sigma uncertainty (in ppm or ppb)</span>
   <span class="n">lat</span>           <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Cell center latitude</span>
   <span class="n">lon</span>           <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Cell center longitude</span>
   <span class="n">year</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Year</span>
   <span class="n">month</span>         <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Month</span>
   <span class="n">nobs</span>          <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Number of underlying single observations (can be 0!)</span>
   <span class="n">land_fraction</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># Fraction of cell covered by land</span>
   <span class="n">c_fac</span> <span class="o">=</span> <span class="mf">0.0</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ... reading ...&#39;</span><span class="p">)</span>
      <span class="n">in_file_OK</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">in_file</span><span class="p">)</span>
      <span class="n">ds</span><span class="o">.</span><span class="n">set_auto_mask</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># then missing values = &#39;--&#39; are 0 (nobs !)</span>
      <span class="n">all_lat</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">][:]</span>  <span class="c1"># 1D: -87.5 -82.5 ...</span>
      <span class="n">all_lon</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">][:]</span>  <span class="c1"># 1D -177.5 -172.5 ...</span>
      <span class="c1">#all_time = ds.variables[&#39;time&#39;][:] # 1D: days since 01-01-1990: 4763.5 4793.0 ...</span>
      <span class="n">all_time_bnds</span>  <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time_bnds&#39;</span><span class="p">][:]</span> <span class="c1"># 2D: time boundaries</span>
      <span class="n">all_time_start</span> <span class="o">=</span> <span class="n">all_time_bnds</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># day number of first day of each month</span>
      <span class="c1">#all_time_end   = all_time_bnds[:,1] # day number of last day of each month</span>
      <span class="c1">#nal_lat  = len(all_lat);   print(&#39;* nal_lat: &#39;, nal_lat)   # 36</span>
      <span class="c1">#nal_lon  = len(all_lon);   print(&#39;* nal_lon: &#39;, nal_lon)   # 72</span>
      <span class="c1">#nal_time = len(all_time);  print(&#39;* nal_time: &#39;, nal_time) # 228</span>
      <span class="c1">#del_lat = 180.0 / nal_lat; print(&#39;* del_lat: &#39;, del_lat)   # 5 deg</span>
      <span class="c1">#del_lon = 360.0 / nal_lon; print(&#39;* del_lon: &#39;, del_lon)   # 5 deg</span>
      <span class="c1">#n_years = nal_time / 12.0; print(&#39;* n_years: &#39;, n_years)   # 19</span>
      <span class="n">all_year</span><span class="p">,</span> <span class="n">all_month</span> <span class="o">=</span> <span class="n">get_year_month_from_o4m_time</span><span class="p">(</span><span class="n">all_time_start</span><span class="p">)</span>
      <span class="n">all_land_fraction</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;land_fraction&#39;</span><span class="p">]</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="c1"># ------------------------------</span>
         <span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCO2&#39;</span><span class="p">:</span>
            <span class="n">all_xghg</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2&#39;</span><span class="p">]</span>                 <span class="c1"># xco2(time,lat,lon)</span>
            <span class="c1">#print(&#39;* all_xghg.shape: &#39;, all_xghg.shape)    # (228, 36, 72)</span>
            <span class="n">all_nobs</span>          <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2_nobs&#39;</span><span class="p">]</span>   <span class="c1"># Number of used observations in cell</span>
            <span class="n">all_xghg_unc</span>      <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2_stderr&#39;</span><span class="p">]</span> <span class="c1"># 1-sigma uncertainty</span>
            <span class="n">all_xghg_std</span>      <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xco2_stddev&#39;</span><span class="p">]</span> <span class="c1"># StdDev of used observations in cell</span>
            <span class="n">c_fac</span> <span class="o">=</span> <span class="mf">1e6</span>                                     <span class="c1"># To convert mixing ratio to ppm</span>
         <span class="c1"># ------------------------------</span>
         <span class="k">if</span> <span class="n">main_product</span> <span class="o">==</span> <span class="s1">&#39;XCH4&#39;</span><span class="p">:</span>
            <span class="n">all_xghg</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4&#39;</span><span class="p">]</span>                 <span class="c1"># xch4(time,lat,lon)</span>
            <span class="c1">#print(&#39;* all_xghg.shape: &#39;, all_xghg.shape)    # (228, 36, 72)</span>
            <span class="n">all_nobs</span>          <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4_nobs&#39;</span><span class="p">]</span>   <span class="c1"># Number of used observations in cell</span>
            <span class="n">all_xghg_unc</span>      <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4_stderr&#39;</span><span class="p">]</span> <span class="c1"># 1-sigma uncertainty</span>
            <span class="n">all_xghg_std</span>      <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;xch4_stddev&#39;</span><span class="p">]</span> <span class="c1"># StdDev of used observations in cell</span>
            <span class="n">c_fac</span> <span class="o">=</span> <span class="mf">1e9</span>                                     <span class="c1"># To convert mixing ratio to ppb</span>
         <span class="c1"># ------------------------------</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* read_o4m_file: ERROR: input file does not exist !&#39;</span><span class="p">)</span>
       <span class="n">in_file_OK</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">in_file_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">xghg</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_xghg</span><span class="p">)</span>
         <span class="n">xghg_unc</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_xghg_unc</span><span class="p">)</span>
         <span class="n">xghg</span>          <span class="o">=</span> <span class="n">xghg</span> <span class="o">*</span> <span class="n">c_fac</span> <span class="c1"># convert to ppm or ppb</span>
         <span class="n">xghg_unc</span>      <span class="o">=</span> <span class="n">xghg_unc</span> <span class="o">*</span> <span class="n">c_fac</span>
         <span class="n">lat</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_lat</span><span class="p">)</span>
         <span class="n">lon</span>           <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_lon</span><span class="p">)</span>
         <span class="n">year</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_year</span><span class="p">)</span>
         <span class="n">month</span>         <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_month</span><span class="p">)</span>
         <span class="n">nobs</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_nobs</span><span class="p">)</span>
         <span class="n">land_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_land_fraction</span><span class="p">)</span>
         <span class="n">ds</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
   <span class="k">return</span> <span class="n">xghg</span><span class="p">,</span> <span class="n">xghg_unc</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">land_fraction</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="reading-an-obs4mips-file">
<h2>Reading an OBS4MIPS file<a class="headerlink" href="#reading-an-obs4mips-file" title="Link to this heading">#</a></h2>
<p>Here the most relevant variables of the selected file are read (GHG concentration, its uncertainty, latitude, longitude, time, etc.):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Read OBS4MIPS file:</span>
<span class="n">read_o4m_file_OK</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">missing_val</span> <span class="o">=</span> <span class="mf">1e10</span> <span class="c1"># keep</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="n">xghg</span><span class="p">,</span> <span class="n">xghg_unc</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">nobs</span><span class="p">,</span> <span class="n">land_fraction</span> <span class="o">=</span> <span class="n">read_o4m_file</span><span class="p">(</span><span class="n">main_product</span><span class="p">,</span> <span class="n">in_file</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">xghg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: Issues reading satellite input data !&#39;</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">read_o4m_file_OK</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ... file reading OK&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">read_o4m_file_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* Array dimensions:&#39;</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* xghg.shape: &#39;</span><span class="p">,</span> <span class="n">xghg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* nobs.shape: &#39;</span><span class="p">,</span> <span class="n">nobs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* year.shape: &#39;</span><span class="p">,</span> <span class="n">year</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* lat.shape: &#39;</span><span class="p">,</span>  <span class="n">lat</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* lon.shape: &#39;</span><span class="p">,</span>  <span class="n">lon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* land_fraction.shape: &#39;</span><span class="p">,</span> <span class="n">land_fraction</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* read_o4m_file: Trying to read:  XCH4_200301_202112-C3S-L3_GHG-GHG_PRODUCTS-MERGED-MERGED-OBS4MIPS-MERGED-v4.4.nc
* ... reading ...
* ... file reading OK
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="application-1-investigating-time-series-for-latitude-bands">
<h1>Application 1: Investigating time series for latitude bands<a class="headerlink" href="#application-1-investigating-time-series-for-latitude-bands" title="Link to this heading">#</a></h1>
<p>Here the user can select a latitude band by specification of lat_min and lat_max.</p>
<p>For this latitude band the data covering the entire time series are generated and plotted.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute time series:</span>
<span class="c1">#</span>
<span class="c1"># Select latitude band etc.:</span>
<span class="c1">#lat_min = -90.0; lat_max = 90.0; min_land_fraction = 0.95; lat_str = &#39;Global (90S - 90N, land)&#39;</span>
<span class="n">lat_min</span> <span class="o">=</span> <span class="mf">30.0</span><span class="p">;</span> <span class="n">lat_max</span> <span class="o">=</span> <span class="mf">60.0</span><span class="p">;</span> <span class="n">min_land_fraction</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">;</span> <span class="n">ts_str</span> <span class="o">=</span> <span class="s1">&#39;Northern Midlatitudes (30N - 60N, land)&#39;</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">read_o4m_file_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
   <span class="n">n_times</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
   <span class="n">ts_year</span>  <span class="o">=</span> <span class="p">[]</span>
   <span class="n">ts_month</span> <span class="o">=</span> <span class="p">[]</span>
   <span class="n">ts_xghg</span>  <span class="o">=</span> <span class="p">[]</span>
   <span class="c1">#n_times = 145 # test</span>
   <span class="c1">#n_times = 2   # test</span>
   <span class="n">n_cnt</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">ts_ok</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># Assume time series OK</span>
   <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_times</span><span class="p">):</span>
      <span class="n">idx_time</span>  <span class="o">=</span> <span class="n">ii</span>
      <span class="n">act_year</span>  <span class="o">=</span> <span class="n">year</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
      <span class="n">act_month</span> <span class="o">=</span> <span class="n">month</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
      <span class="c1">#print(&#39;* ii act_year act_month: &#39;, ii, act_year, act_month)</span>
      <span class="n">xghg_act</span>  <span class="o">=</span> <span class="n">xghg</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="c1"># (36, 72); xghg.shape = (228, 36, 72)</span>
      <span class="n">idx_lat</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">lat_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">lat_max</span><span class="p">))</span>
      <span class="n">xghg_tmp1</span> <span class="o">=</span> <span class="n">xghg_act</span><span class="p">[</span><span class="n">idx_lat</span><span class="p">,</span> <span class="p">:]</span>
      <span class="n">lf_tmp1</span>   <span class="o">=</span> <span class="n">land_fraction</span><span class="p">[</span><span class="n">idx_lat</span><span class="p">,</span> <span class="p">:]</span>
      <span class="n">idx_good</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">xghg_tmp1</span> <span class="o">&lt;</span> <span class="n">missing_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lf_tmp1</span> <span class="o">&gt;=</span> <span class="n">min_land_fraction</span><span class="p">))</span>
      <span class="c1">#idx_good  = np.where((xghg_tmp1 &lt; missing_val))</span>
      <span class="c1">#len_idx_good = len(idx_good)</span>
      <span class="c1">#print(&#39;* len_idx_good: &#39;, len_idx_good)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">idx_good</span><span class="p">)):</span>
         <span class="n">xghg_tmp2</span> <span class="o">=</span> <span class="n">xghg_tmp1</span><span class="p">[</span><span class="n">idx_good</span><span class="p">]</span>
         <span class="n">xghg_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">xghg_tmp2</span><span class="p">)</span>
         <span class="n">ts_year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_year</span><span class="p">)</span>
         <span class="n">ts_month</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act_month</span><span class="p">)</span>
         <span class="n">ts_xghg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xghg_median</span><span class="p">)</span>
         <span class="n">n_cnt</span> <span class="o">=</span> <span class="n">n_cnt</span> <span class="o">+</span> <span class="mi">1</span>
   <span class="k">if</span> <span class="n">n_cnt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">ts_year</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ts_year</span><span class="p">)</span>
         <span class="n">ts_month</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ts_month</span><span class="p">)</span>
         <span class="n">ts_xghg</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ts_xghg</span><span class="p">)</span>
         <span class="n">ts_fyear</span> <span class="o">=</span> <span class="n">ts_year</span> <span class="o">+</span> <span class="p">(</span><span class="n">ts_month</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mf">12.0</span> <span class="c1"># time in fractional years (approx.)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR computing time series: No data found !&#39;</span><span class="p">)</span>
      <span class="n">ts_ok</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="c1"># Plot time series</span>
   <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">ts_ok</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">xxx</span> <span class="o">=</span> <span class="n">ts_fyear</span>
         <span class="n">yyy</span> <span class="o">=</span> <span class="n">ts_xghg</span>
         <span class="n">x_min</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">ts_year</span><span class="p">)</span>
         <span class="n">x_max</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">ts_year</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
         <span class="n">x_ticks</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1">#figsize = (8,5)</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.11</span><span class="p">,</span><span class="mf">0.88</span><span class="p">,</span><span class="mf">0.83</span><span class="p">]</span>     <span class="c1"># pos (l,b,w,h) in page coord</span>
            <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xxx</span><span class="p">,</span> <span class="n">yyy</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
         <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">),</span> <span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
         <span class="n">title</span> <span class="o">=</span> <span class="n">xghg_str</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">ts_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">product_ver</span>
         <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Time [years]&#39;</span>
         <span class="n">y_label</span> <span class="o">=</span> <span class="n">xghg_str1</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">xghg_unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
            <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">main_product</span><span class="o">+</span><span class="s1">&#39;_OBS4MIPS_timeseries.png&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* generating:  XCH4_OBS4MIPS_timeseries.png
</pre></div>
</div>
<img alt="../_images/5b660c1cacc84f83b73d6a24ae91bc01726502e99c087c8ab4dfb37022eec8a9.png" src="../_images/5b660c1cacc84f83b73d6a24ae91bc01726502e99c087c8ab4dfb37022eec8a9.png" />
</div>
</div>
<p>What does this time series tells us?: As can be seen, XCH4 has a strong seasonal cycle with a maximum in the second half of each year over northern hemispheric mid-latitudes. This is mainly due to natural sources such as wetlands, where CH4 emissions are largest when temperatures are high. As can also be seen, XCH4 was (apart from seasonal fluctuations) relatively constant until about 2006. Since 2007 methane is increasing (increasing again as methane was also increasing for several decades until the late 1990th). Additional information on these satellite-derived XCH4 and XCO2 time series can be found in the Copernicus press release from January 2023, where these data sets have been used: “Copernicus: 2022 was a year of climate extremes, with record high temperatures and rising concentrations of greenhouse gases”, see <a class="reference external" href="https://climate.copernicus.eu/copernicus-2022-was-year-climate-extremes-record-high-temperatures-and-rising-concentrations">https://climate.copernicus.eu/copernicus-2022-was-year-climate-extremes-record-high-temperatures-and-rising-concentrations</a>. Please have to look at that website to get additional information about the evolution of atmospheric CO2 and XCH using these satellite observations including links to relevant scientific publications.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="application-2-investigating-spatial-variations-and-coverage">
<h1>Application 2: Investigating spatial variations and coverage<a class="headerlink" href="#application-2-investigating-spatial-variations-and-coverage" title="Link to this heading">#</a></h1>
<p>Here the user can chose time (year and month) and spatial domain to generate plots of the spatial distribution of the selected GHG.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate map and plot it using imshow</span>
<span class="k">if</span> <span class="p">((</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">read_o4m_file_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
   <span class="c1"># Select year and month:</span>
   <span class="c1">#wanted_year  = 2004</span>
   <span class="n">wanted_year</span>  <span class="o">=</span> <span class="mi">2021</span>
   <span class="c1">#wanted_month = 1;    wanted_month_str = &#39;Jan&#39;</span>
   <span class="n">wanted_month</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>    <span class="n">wanted_month_str</span> <span class="o">=</span> <span class="s1">&#39;Sep&#39;</span>
   <span class="c1">#</span>
   <span class="n">wanted_year_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">wanted_year</span><span class="p">)</span>
   <span class="n">title</span> <span class="o">=</span> <span class="n">xghg_str</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">product_ver</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">wanted_month_str</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">wanted_year_str</span>
   
   <span class="n">min_land_fraction</span> <span class="o">=</span> <span class="mf">0.0</span>
   
   <span class="n">xghg_unc_OK</span> <span class="o">=</span> <span class="mi">0</span>
   <span class="n">title_unc</span> <span class="o">=</span> <span class="s1">&#39;Uncertainty - &#39;</span><span class="o">+</span><span class="n">product_ver</span><span class="o">+</span><span class="s1">&#39; - &#39;</span><span class="o">+</span><span class="n">wanted_month_str</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">wanted_year_str</span>
   
   <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">179.0</span>
      <span class="n">lonmax</span> <span class="o">=</span>  <span class="mf">179.0</span>
      <span class="n">latmin</span> <span class="o">=</span>  <span class="o">-</span><span class="mf">85.0</span>
      <span class="n">latmax</span> <span class="o">=</span>   <span class="mf">85.0</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">30.0</span>
      <span class="n">lonmax</span> <span class="o">=</span>  <span class="mf">80.0</span>
      <span class="n">latmin</span> <span class="o">=</span>  <span class="mf">10.0</span>
      <span class="n">latmax</span> <span class="o">=</span>  <span class="mf">70.0</span>
   
   <span class="c1"># Get time index:</span>
   <span class="n">idx_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">year</span> <span class="o">==</span> <span class="n">wanted_year</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">month</span> <span class="o">==</span> <span class="n">wanted_month</span><span class="p">))</span>
   <span class="n">len_idx_time</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx_time</span><span class="p">)</span>
   <span class="c1">#</span>
   <span class="c1"># If OK, then proceed:</span>
   <span class="k">if</span> <span class="n">len_idx_time</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c1"># Get global map for selected year and month;</span>
      <span class="n">idx_time0</span> <span class="o">=</span> <span class="n">idx_time</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">map_xghg_all</span>     <span class="o">=</span> <span class="n">xghg</span><span class="p">[</span><span class="n">idx_time0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> 
      <span class="n">map_xghg_unc_all</span> <span class="o">=</span> <span class="n">xghg_unc</span><span class="p">[</span><span class="n">idx_time0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> 
      <span class="c1"># Reduce to selected region:</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">idx_lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">latmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">latmax</span><span class="p">))</span>
         <span class="n">idx_lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lonmax</span><span class="p">))</span>
         <span class="n">lat_red</span>  <span class="o">=</span> <span class="n">lat</span><span class="p">[</span><span class="n">idx_lat</span><span class="p">]</span>
         <span class="n">lon_red</span>  <span class="o">=</span> <span class="n">lon</span><span class="p">[</span><span class="n">idx_lon</span><span class="p">]</span>
         <span class="n">xghg_red</span>     <span class="o">=</span> <span class="n">map_xghg_all</span><span class="p">[</span><span class="n">idx_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx_lon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx_lon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">xghg_unc_red</span> <span class="o">=</span> <span class="n">map_xghg_unc_all</span><span class="p">[</span><span class="n">idx_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx_lat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">idx_lon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">idx_lon</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">idx_good</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xghg_red</span> <span class="o">&lt;</span> <span class="n">missing_val</span><span class="p">)</span>
      <span class="c1"># --------------------------</span>
      <span class="c1"># XGHG:</span>
      <span class="n">tmp1</span> <span class="o">=</span> <span class="n">xghg_red</span><span class="p">[</span><span class="n">idx_good</span><span class="p">]</span>
      <span class="n">xghg_median</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp1</span><span class="p">))</span>
      <span class="n">xghg_std</span>    <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">tmp1</span><span class="p">))</span>
      <span class="n">rcen</span> <span class="o">=</span> <span class="n">xghg_median</span>
      <span class="n">rmin</span> <span class="o">=</span> <span class="n">rcen</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">xghg_std</span>
      <span class="n">rmax</span> <span class="o">=</span> <span class="n">rcen</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">xghg_std</span>
      <span class="n">idx_bad</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xghg_red</span> <span class="o">&gt;</span> <span class="n">missing_val</span><span class="p">)</span>
      <span class="n">xghg_red</span><span class="p">[</span><span class="n">idx_bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># fill missing values with NaNs</span>
      <span class="c1"># --------------------------</span>
      <span class="c1"># XGHG uncertainty:</span>
      <span class="n">tmp2</span> <span class="o">=</span> <span class="n">xghg_unc_red</span><span class="p">[</span><span class="n">idx_good</span><span class="p">]</span>
      <span class="n">xghg_unc_median</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">tmp2</span><span class="p">))</span>
      <span class="n">rmin_unc</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">rmax_unc</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">xghg_unc_median</span>
      <span class="n">xghg_unc_red</span><span class="p">[</span><span class="n">idx_bad</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="c1"># fill missing values with NaNs</span>
      <span class="n">xghg_unc_OK</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="c1"># --------------------------</span>
      <span class="c1"># --------------------------------------</span>
      <span class="n">projection</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
         <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
         <span class="n">pos</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.08</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.95</span><span class="p">,</span><span class="mf">0.95</span><span class="p">]</span>     <span class="c1"># pos (l,b,w,h) in page coord</span>
         <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
         <span class="c1">#ax1 = fig.add_subplot(1,1,1, projection=projection) # &#39;GeoAxesSubplot&#39; object</span>
         <span class="c1">#ax1.set_position(pos=pos)</span>
         <span class="n">ax1</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
         <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;powderblue&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">drawmeridians_label</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">draw_labels</span><span class="o">=</span><span class="n">drawmeridians_label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="c1">#gl.xlabels_top = False</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>   <span class="o">=</span> <span class="kc">False</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
         <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
         <span class="n">lat1</span> <span class="o">=</span> <span class="n">lat_red</span>
         <span class="n">lon1</span> <span class="o">=</span> <span class="n">lon_red</span>
         <span class="n">dat1</span> <span class="o">=</span> <span class="n">xghg_red</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Expand region (cell center coords -&gt; cell edge coords):</span>
            <span class="n">dd</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.5</span>
            <span class="n">lomi</span> <span class="o">=</span> <span class="n">lon1</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">dd</span>
            <span class="n">loma</span> <span class="o">=</span> <span class="n">lon1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">dd</span>
            <span class="n">lami</span> <span class="o">=</span> <span class="n">lat1</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">dd</span>
            <span class="n">lama</span> <span class="o">=</span> <span class="n">lat1</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">dd</span>
            <span class="n">dat1_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">dat1</span><span class="p">)</span>
            <span class="n">im</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dat1_trans</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">lomi</span><span class="p">,</span> <span class="n">loma</span><span class="p">,</span> <span class="n">lami</span><span class="p">,</span> <span class="n">lama</span><span class="p">])</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span><span class="p">,</span> <span class="n">dat1</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
      <span class="c1"># --------------------------------------</span>
      <span class="n">do_cb</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">do_cb</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="c1">#cbar = plt.colorbar(im, extend=&#39;both&#39;, location=&#39;bottom&#39;, shrink=0.4)</span>
         <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
         <span class="c1">#cbar = plt.colorbar(im, ax=ax)</span>
         <span class="c1">#cbar.set_label(&#39;# of contacts&#39;, rotation=270)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">xghg_str2</span><span class="p">)</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="c1">#plot_type = &#39;screen&#39;</span>
         <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
            <span class="n">o_file_plot</span> <span class="o">=</span> <span class="n">main_product</span><span class="o">+</span><span class="s1">&#39;_OBS4MIPS_cmap.png&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* ERROR: Cannot plot map: issue related to idx_time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* generating:  XCH4_OBS4MIPS_cmap.png
</pre></div>
</div>
<img alt="../_images/a1f3c5500a4bf385db05e36e1131f17c2b9870330b392a92c5d8cb37a9ffaedc.png" src="../_images/a1f3c5500a4bf385db05e36e1131f17c2b9870330b392a92c5d8cb37a9ffaedc.png" />
</div>
</div>
<p>As can be seen, the spatial variation is typically small. The largest difference is often the interhemisheric difference, i.e., the concentration difference between the two hemispheres. Nevertheless, strong source regions may be visible via locally enhanced concentrations.</p>
<p>Here a second maps is generated to see the corresponding (1-sigma) uncertainty of the satellite observations, which is contained for each month and each grid cell in the data product.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot uncertainty:</span>
<span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">xghg_unc_OK</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="c1">#figsize = (11,5)</span>
         <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
         <span class="c1">#pos = [0.08,0.02,0.95,0.95]     # pos (l,b,w,h) in page coord</span>
         <span class="n">ax1</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">projection</span><span class="p">)</span>
         <span class="n">ax1</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
         <span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;powderblue&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">drawmeridians_label</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">gl</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">projection</span><span class="p">,</span> <span class="n">draw_labels</span><span class="o">=</span><span class="n">drawmeridians_label</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">top_labels</span>   <span class="o">=</span> <span class="kc">False</span>
            <span class="n">gl</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
         <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmin_unc</span><span class="p">,</span> <span class="n">rmax_unc</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
         <span class="n">dat1_unc</span> <span class="o">=</span> <span class="n">xghg_unc_red</span>
         <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dat1_unc_trans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">dat1_unc</span><span class="p">)</span>
            <span class="n">im</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dat1_unc_trans</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">lomi</span><span class="p">,</span> <span class="n">loma</span><span class="p">,</span> <span class="n">lami</span><span class="p">,</span> <span class="n">lama</span><span class="p">])</span>
         <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title_unc</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
      <span class="c1"># --------------------------------------</span>
      <span class="n">do_cb</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">do_cb</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Uncertainty (1-sigma) &#39;</span><span class="o">+</span><span class="n">xghg_str1</span><span class="o">+</span><span class="s1">&#39; [&#39;</span><span class="o">+</span><span class="n">xghg_unit</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="c1">#plot_type = &#39;screen&#39;</span>
         <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;png&#39;</span><span class="p">:</span>
            <span class="n">o_file_plot_unc</span> <span class="o">=</span> <span class="n">main_product</span><span class="o">+</span><span class="s1">&#39;_uncertainty_OBS4MIPS_cmap.png&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;* generating: &#39;</span><span class="p">,</span> <span class="n">o_file_plot_unc</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">o_file_plot_unc</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>* generating:  XCH4_uncertainty_OBS4MIPS_cmap.png
</pre></div>
</div>
<img alt="../_images/571e5e4ed9aa7d99d1ddc2bc88059ee8995fb006710b072e6a1106b4dee8bc41.png" src="../_images/571e5e4ed9aa7d99d1ddc2bc88059ee8995fb006710b072e6a1106b4dee8bc41.png" />
</div>
</div>
<p>As can be seen, the uncertainty is similar for most regions. For XCH4 the uncertainty is typically on the order of 10 ppb, but may be as large a 20 or 30 ppb for some regions. These are mostly regions with sparse coverage (e.g. due to clouds) and/or a poorly reflecting surface.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./ecv-notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="greenhouse-gases-level2-products.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">How to access and use a satellite-derived GHG Level 2 data product using XCO2_EMMA as an example?</p>
      </div>
    </a>
    <a class="right-next"
       href="aerosol-single-sensor-demonstrator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Exploring gridded data on Aerosol properties available on C3S</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">How to access, read and use satellite XCO2 and XCH4 Level 3 data products</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-get-the-satellite-data-products">How to get the satellite data products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-via-the-cds-website">Data download via the CDS website</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-and-process-the-satellite-data-with-python">How to read and process the satellite data with Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-user-input">Initial user input</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-settings">Initial settings</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-an-obs4mips-file">Reading an OBS4MIPS file</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-1-investigating-time-series-for-latitude-bands">Application 1: Investigating time series for latitude bands</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#application-2-investigating-spatial-variations-and-coverage">Application 2: Investigating spatial variations and coverage</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>